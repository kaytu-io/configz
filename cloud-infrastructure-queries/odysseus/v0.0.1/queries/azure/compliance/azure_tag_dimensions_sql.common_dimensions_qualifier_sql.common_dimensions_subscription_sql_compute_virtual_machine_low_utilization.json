{
  "ID": "azure_tag_dimensions_sql.common_dimensions_qualifier_sql.common_dimensions_subscription_sql_compute_virtual_machine_low_utilization",
  "Engine": "odysseus-v0.0.1",
  "QueryToExecute": "with compute_virtual_machine_utilization as (\n  select\n    name,\n    round(cast(sum(maximum)/count(maximum) as numeric), 1) as avg_max,\n    count(maximum) as days\n  from\n    azure_compute_virtual_machine_metric_cpu_utilization_daily\n  where\n    date_part('day', now() - timestamp) \u003c=30\n  group by\n    name\n)\nselect\n  v.id as resource,\n  case\n    when avg_max is null then 'error'\n    when avg_max \u003c $1 then 'alarm'\n    when avg_max \u003c $2 then 'info'\n    else 'ok'\n  end as status,\n  case\n    when avg_max is null then 'Monitor metrics not available for ' || v.title || '.'\n    else v.title || ' averaging ' || avg_max || '% max utilization over the last ' || days || ' days.'\n  end as reason\n  \n  , v.resource_group\n  , display_name as subscription\nfrom\n  azure_compute_virtual_machine as v\n  left join compute_virtual_machine_utilization as u on u.name = v.name\n  left join azure_subscription as sub on sub.subscription_id = v.subscription_id;\n",
  "Connector": "Azure",
  "PrimaryTable": "azure_compute_virtual_machine",
  "ListOfTables": [
    "azure_compute_virtual_machine",
    "azure_compute_virtual_machine_metric_cpu_utilization_daily",
    "azure_subscription"
  ]
}