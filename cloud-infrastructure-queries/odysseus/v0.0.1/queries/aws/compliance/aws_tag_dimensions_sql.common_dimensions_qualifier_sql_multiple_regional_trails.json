{
  "ID": "aws_tag_dimensions_sql.common_dimensions_qualifier_sql_multiple_regional_trails",
  "Engine": "odysseus-v0.0.1",
  "QueryToExecute": "with\n  global_trails as (\n    select\n      count(*) as total\n    from\n      aws_cloudtrail_trail\n    where\n      is_multi_region_trail\n  ),\n  org_trails as (\n    select\n      count(*) as total\n    from\n      aws_cloudtrail_trail\n    where\n      is_organization_trail\n  ),\n  regional_trails as (\n    select\n      region,\n      count(*) as total\n    from\n      aws_cloudtrail_trail\n    where\n      not is_multi_region_trail\n      and not is_organization_trail\n    group by\n      region\n  )\nselect\n  arn as resource,\n  case\n    when global_trails.total \u003e 0 then 'alarm'\n    when org_trails.total \u003e 0 then 'alarm'\n    when regional_trails.total \u003e 1 then 'alarm'\n    else 'ok'\n  end as status,\n  case\n    when global_trails.total \u003e 0 then name || ' is redundant to a global trail.'\n    when org_trails.total \u003e 0 then name || ' is redundant to a organizational trail.'\n    when regional_trails.total \u003e 1 then name || ' is one of ' || regional_trails.total || ' trails in ' || t.region || '.'\n    else name || ' is the only global trail.'\n  end as reason\n  \n  , t.region, t.account_id\nfrom\n  aws_cloudtrail_trail t,\n  global_trails,\n  org_trails,\n  regional_trails\nwhere\n  regional_trails.region = t.region\n  and not is_multi_region_trail\n  and not is_organization_trail;\n",
  "Connector": "AWS",
  "PrimaryTable": "aws_cloudtrail_trail",
  "ListOfTables": [
    "aws_cloudtrail_trail"
  ]
}