{
  "ID": "aws_tag_dimensions_sql.common_dimensions_sql_lambda_function_high_error_rate",
  "Engine": "odysseus-v0.0.1",
  "QueryToExecute": "with error_rate as (\n  select\n    errors.name as name,\n    sum(errors.sum)/sum(invocations.sum)*100 as error_rate\n  from\n    aws_lambda_function_metric_errors_daily as errors , aws_lambda_function_metric_invocations_daily as invocations\n  where\n    date_part('day', now() - errors.timestamp) \u003c=7 and errors.name = invocations.name\n  group by\n    errors.name\n)\nselect\n  arn as resource,\n  case\n    when error_rate is null then 'error'\n    when error_rate \u003e 10 then 'alarm'\n    else 'ok'\n  end as status,\n  case\n    when error_rate is null then 'CloudWatch Lambda function metrics not available for ' || title || '.'\n    else title || ' error rate is ' || error_rate || '% the last ' || '7  days.'\n  end as reason\n  \n  , region, account_id\nfrom\n  aws_lambda_function f\n  left join error_rate as er on f.name = er.name;\n",
  "Connector": "AWS",
  "PrimaryTable": "aws_lambda_function",
  "ListOfTables": [
    "aws_lambda_function",
    "aws_lambda_function_metric_errors_daily",
    "aws_lambda_function_metric_invocations_daily"
  ]
}