ID: aws_iam_managed_policy_attached_to_role
Title: IAM AWS managed policies should be attached to IAM role
Description: This control checks if all AWS managed policies specified in the list of managed policies are attached to the AWS Identity and Access Management (IAM) role. The rule is non compliant if an AWS managed policy is not attached to the IAM role.
Query:
    ID: ""
    Engine: odysseus-v0.0.1
    QueryToExecute: "with role_attached_policies as (\n  select\n    jsonb_array_elements_text(attached_policy_arns) as policy_arn\n  from\n    aws_iam_role\n)\nselect\n  arn as resource,\n  kaytu_account_id as kaytu_account_id,\n  kaytu_resource_id as kaytu_resource_id,\n  case\n    when arn in (select policy_arn from role_attached_policies) then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when arn in (select policy_arn from role_attached_policies) then title || ' attached to IAM role.'\n    else title || ' not attached to IAM role.'\n  end as reason\n  \n  , account_id\nfrom\n  aws_iam_policy\nwhere\n  is_aws_managed;\n"
    Connector: AWS
    PrimaryTable: aws_iam_policy
    ListOfTables:
        - aws_iam_policy
        - aws_iam_role
    Parameters: []
ManualVerification: false
Severity: medium
Tags:
    category:
        - Compliance
    cis_controls_v8_ig1:
        - "true"
    gxp_21_cfr_part_11:
        - "true"
    nist_csf:
        - "true"
    plugin:
        - aws
    service:
        - AWS/IAM
    soc_2:
        - "true"
Managed: false
