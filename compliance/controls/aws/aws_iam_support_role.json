{
  "ID": "aws_iam_support_role",
  "Title": "Ensure a support role has been created to manage incidents with AWS Support",
  "Description": "AWS provides a support center that can be used for incident notification and response, as well as technical support and customer services. Create an IAM Role to allow authorized users to manage incidents with AWS Support.",
  "Query": {
    "Engine": "odysseus-v0.0.1",
    "QueryToExecute": "-- pgFormatter-ignore\nwith support_role_count as\n(\n  select\n    'arn:' || a.partition || ':::' || a.account_id as resource,\n    count(policy_arn),\n    a.account_id,\n    a._ctx\n  from\n    aws_account as a\n    left join aws_iam_role as r on r.account_id = a.account_id\n    left join jsonb_array_elements_text(attached_policy_arns) as policy_arn  on true\n  where\n    split_part(policy_arn, '/', 2) = 'AWSSupportAccess'\n    or policy_arn is null\n  group by\n    a.account_id,\n    a.partition,\n    a._ctx\n)\nselect\n  resource,\n  case\n    when count \u003e 0 then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when count = 1 then 'AWSSupportAccess policy attached to 1 role.'\n    when count \u003e 1 then 'AWSSupportAccess policy attached to ' || count || ' roles.'\n    else 'AWSSupportAccess policy not attached to any role.'\n  end  as reason\n  , account_id\nfrom\n  support_role_count;\n",
    "Connector": "AWS",
    "PrimaryTable": "aws_account",
    "ListOfTables": [
      "aws_account",
      "aws_iam_role"
    ]
  },
  "ManualVerification": false,
  "Severity": "",
  "Tags": {
    "category": [
      "Compliance"
    ],
    "cis": [
      "true"
    ],
    "cis_item_id": [
      "1.20"
    ],
    "cis_level": [
      "1"
    ],
    "cis_section_id": [
      "1"
    ],
    "cis_type": [
      "scored"
    ],
    "cis_version": [
      "v1.2.0"
    ],
    "plugin": [
      "aws"
    ],
    "service": [
      "AWS/IAM"
    ]
  },
  "Managed": true
}