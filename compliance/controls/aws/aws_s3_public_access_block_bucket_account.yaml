Description: Amazon S3 provides Block public access (bucket settings) and Block public access (account settings) to help you manage public access to Amazon S3 resources. By default, S3 buckets and objects are created with public access disabled. However, an IAM principle with sufficient S3 permissions can enable public access at the bucket and/or object level. While enabled, Block public access (bucket settings) prevents an individual bucket, and its contained objects, from becoming publicly accessible. Similarly, Block public access (account settings) prevents all buckets, and contained objects, from becoming publicly accessible across the entire account.
DocumentURI: ""
ID: aws_s3_public_access_block_bucket_account
Managed: true
ManualVerification: false
Query:
  Connector: AWS
  Engine: odysseus-v0.0.1
  ListOfTables:
  - aws_s3_bucket
  PrimaryTable: aws_s3_bucket
  QueryToExecute: "select\n  bucket.arn as resource,\n  bucket.kaytu_account_id as kaytu_account_id,\n  bucket.kaytu_resource_id as kaytu_resource_id,\n  case\n    when (bucket.block_public_acls or s3account.block_public_acls)\n      and (bucket.block_public_policy or s3account.block_public_policy)\n      and (bucket.ignore_public_acls or s3account.ignore_public_acls)\n      and (bucket.restrict_public_buckets or s3account.restrict_public_buckets)\n      then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when (bucket.block_public_acls or s3account.block_public_acls)\n      and (bucket.block_public_policy or s3account.block_public_policy)\n      and (bucket.ignore_public_acls or s3account.ignore_public_acls)\n      and (bucket.restrict_public_buckets or s3account.restrict_public_buckets)\n      then name || ' all public access blocks enabled.'\n    else name || ' not enabled for: ' ||\n      concat_ws(', ',\n        case when not (bucket.block_public_acls or s3account.block_public_acls) then 'block_public_acls' end,\n        case when not (bucket.block_public_policy or s3account.block_public_policy) then 'block_public_policy' end,\n        case when not (bucket.ignore_public_acls or s3account.ignore_public_acls) then 'ignore_public_acls' end,\n        case when not (bucket.restrict_public_buckets or s3account.restrict_public_buckets) then 'restrict_public_buckets' end\n      ) || '.'\n  end as reason\n  \n  , bucket.region, bucket.account_id\nfrom\n  aws_s3_bucket as bucket,\n  aws_s3_account_settings as s3account\nwhere\n  s3account.account_id = bucket.account_id;\n"
Severity: high
Tags:
  category:
  - Compliance
  cis:
  - "true"
  cis_item_id:
  - "1.20"
  cis_level:
  - "1"
  cis_section_id:
  - "1"
  cis_type:
  - automated
  cis_version:
  - v1.3.0
  plugin:
  - aws
  service:
  - AWS/S3
  x-kaytu-explanation:
  - "```markdown\n# Amazon S3: Block Public Access\n\nAmazon S3 provides two key settings to help control public accessibility of your S3 resources:\n\n1. **Block public access (bucket settings)**: This setting is applied to an individual bucket and its contained objects. When enabled, this ensures that the bucket and the objects within it remain inaccessible to the public, irrespective of the permissions assigned at the IAM level.\n\n2. **Block public access (account settings)**: This setting is applied to all the buckets and their contained objects under the entire AWS account. When enabled, it ensures that none of the buckets, or any objects within them, under the chosen AWS account become publicly accessible.\n\nIn terms of accessibility, when a new S3 bucket or object is created, it is set to be private by default. However, if an IAM principle has the necessary S3 permissions, they can change this setting and enable public access at both the bucket and/or object levels. By enabling the Block public access settings, you can prevent changes to the accessibility of your buckets and objects, thereby maintaining control over who can and cannot access your S3 resources.\n```\n"
  x-kaytu-noncompliance-cost:
  - "The cost of non-compliance to the AWS control of blocking public access to Amazon S3 resources could be severe and far-reaching. Here are the top potential risks and costs:\n\n1. **Data Breach**: If public access is not blocked, it paves the way for unauthorized users to access sensitive data. This could potentially lead to a data breach, the costs of which can be astronomical, both in terms of financial damage and damage to the organization's reputation.\n\n2. **Legal costs**: If a data breach results in the disclosure of personal or sensitive information, it could lead to lawsuits and legal claims. The company would therefore need to bear the cost of legal proceedings, and potentially, hefty fines.\n\n3. **Non-compliance penalties**: Not adhering to data privacy regulations like GDPR, CCPA, or HIPAA can lead to hefty fines, which could go up to millions of dollars, depending on the severity of the non-compliance.\n\n4. **Loss of business**: In case of a data breach, loss of customer trust can lead to loss of business. Studies have shown that customers tend to switch away from businesses that have suffered data breaches.\n\n5. **Incident response costs**: If public access is not blocked and an incident occurs, organizations would need to bear the cost of analyzing and responding to the incident. This would include cost of time and resources dedicated to uncover the source of the problem, mitigation strategies, and further fortification of security measures.\n\n6. **Disruption of business operations**: If the breach is severe, it might lead to significant downtime and disruption of normal business operations. This leads to an additional cost both in terms of lost business, and cost of time and resources that should have been dedicated to daily operations but were diverted to handle the incident.\n\nIn conclusion, the cost of non-compliance to the AWS S3 block public access setting could have substantial financial implications and should be managed carefully and proactively."
  x-kaytu-usefulness-example:
  - |-
    For example, a media company uploads their premium content on Amazon S3 to distribute among their subscribers. During upload, the administrator accidentally un-checked the "Block Public Access" option at the bucket level, which would make the entire bucket open to the public. This could lead to unauthorized access to their premium content and therefore, loss of revenue.

    By having the "Block Public Access" option enabled at the account level in advance, the company would have had an additional layer of security. Even in case of accidental configuration changes at the bucket level, the account level setting would still keep their content secure and inaccessible to the public.

    Similarly, an individual user may have personal data in an S3 bucket. They might be accessing it from different devices, and accidentally grant public access permissions from one of those devices. An account level Block public access control would ensure the data remains private, despite the user's error. 

    These controls are particularly useful for large organizations and the management of multiple buckets for various applications, where it's hard to track and manage the access permissions for each S3 bucket. It helps to enforce company-wide security policies and ensure data isn't accidentally exposed to the public.
Title: Ensure that S3 Buckets are configured with 'Block public access (bucket settings)'
