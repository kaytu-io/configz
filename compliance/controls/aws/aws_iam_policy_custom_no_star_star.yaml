ID: aws_iam_policy_custom_no_star_star
Title: IAM policy should not have statements with admin access
Description: 'AWS Identity and Access Management (IAM) can help you incorporate the principles of least privilege and separation of duties with access permissions and authorizations, restricting policies from containing ''Effect'': ''Allow'' with ''Action'': ''*'' over ''Resource'': ''*''.'
Query:
    ID: ""
    Engine: odysseus-v0.0.1
    QueryToExecute: "with bad_policies as (\n  select\n    arn,\n    count(*) as num_bad_statements\n  from\n    aws_iam_policy,\n    jsonb_array_elements(policy_std -> 'Statement') as s,\n    jsonb_array_elements_text(s -> 'Resource') as resource,\n    jsonb_array_elements_text(s -> 'Action') as action\n  where\n    not is_aws_managed\n    and s ->> 'Effect' = 'Allow'\n    and resource = '*'\n    and (\n      (action = '*'\n      or action = '*:*'\n      )\n    )\n  group by\n    arn\n)\nselect\n  p.arn as resource,\n  p.kaytu_account_id as kaytu_account_id,\n  p.kaytu_resource_id as kaytu_resource_id,\n  case\n    when bad.arn is null then 'ok'\n    else 'alarm'\n  end status,\n  p.name || ' contains ' || coalesce(bad.num_bad_statements,0)  ||\n    ' statements that allow action \"*\" on resource \"*\".' as reason\n  \n  , p.account_id\nfrom\n  aws_iam_policy as p\n  left join bad_policies as bad on p.arn = bad.arn\nwhere\n  not p.is_aws_managed;\n"
    Connector: AWS
    PrimaryTable: aws_iam_policy
    ListOfTables:
        - aws_iam_policy
    Parameters: []
ManualVerification: false
Severity: high
Tags:
    category:
        - Compliance
    cis_controls_v8_ig1:
        - "true"
    cisa_cyber_essentials:
        - "true"
    fedramp_low_rev_4:
        - "true"
    fedramp_moderate_rev_4:
        - "true"
    ffiec:
        - "true"
    gdpr:
        - "true"
    gxp_21_cfr_part_11:
        - "true"
    hipaa_final_omnibus_security_rule_2013:
        - "true"
    hipaa_security_rule_2003:
        - "true"
    nist_800_53_rev_4:
        - "true"
    nist_800_53_rev_5:
        - "true"
    nist_800_171_rev_2:
        - "true"
    nist_csf:
        - "true"
    pci_dss_v321:
        - "true"
    plugin:
        - aws
    rbi_cyber_security:
        - "true"
    service:
        - AWS/IAM
    soc_2:
        - "true"
Managed: false
