{
  "ID": "aws_iam_policy_custom_no_service_wildcard",
  "Title": "Ensure IAM policy should not grant full access to service",
  "Description": "Checks if AWS Identity and Access Management (IAM) policies grant permissions to all actions on individual AWS resources. The rule is non compliant if the managed IAM policy allows full access to at least 1 AWS service.",
  "Query": {
    "Engine": "odysseus-v0.0.1",
    "QueryToExecute": "with wildcard_action_policies as (\n  select\n    arn,\n    count(*) as statements_num\n  from\n    aws_iam_policy,\n    jsonb_array_elements(policy_std -\u003e 'Statement') as s,\n    jsonb_array_elements_text(s -\u003e 'Resource') as resource,\n    jsonb_array_elements_text(s -\u003e 'Action') as action\n  where\n    not is_aws_managed\n    and s -\u003e\u003e 'Effect' = 'Allow'\n    and resource = '*'\n    and (\n      action like '%:*'\n      or action = '*'\n    )\n  group by\n    arn\n)\nselect\n  p.arn as resource,\n  case\n    when w.arn is null then 'ok'\n    else 'alarm'\n  end status,\n  p.name || ' contains ' || coalesce(w.statements_num,0)  ||\n    ' statements that allow action \"*\" on at least 1 AWS service on resource \"*\".' as reason\n  \n  , p.account_id\nfrom\n  aws_iam_policy as p\n  left join wildcard_action_policies as w on p.arn = w.arn\nwhere\n  not p.is_aws_managed;\n",
    "Connector": "AWS",
    "PrimaryTable": "aws_iam_policy",
    "ListOfTables": [
      "aws_iam_policy"
    ]
  },
  "ManualVerification": false,
  "Severity": "",
  "Tags": {
    "category": [
      "Compliance"
    ],
    "cis_controls_v8_ig1": [
      "true"
    ],
    "fedramp_low_rev_4": [
      "true"
    ],
    "fedramp_moderate_rev_4": [
      "true"
    ],
    "ffiec": [
      "true"
    ],
    "gxp_21_cfr_part_11": [
      "true"
    ],
    "hipaa_final_omnibus_security_rule_2013": [
      "true"
    ],
    "nist_800_171_rev_2": [
      "true"
    ],
    "nist_800_53_rev_5": [
      "true"
    ],
    "nist_csf": [
      "true"
    ],
    "pci_dss_v321": [
      "true"
    ],
    "plugin": [
      "aws"
    ],
    "rbi_cyber_security": [
      "true"
    ],
    "service": [
      "AWS/IAM"
    ]
  },
  "Managed": true
}