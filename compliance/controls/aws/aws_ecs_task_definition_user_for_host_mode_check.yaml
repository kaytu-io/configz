ID: aws_ecs_task_definition_user_for_host_mode_check
Title: ECS task definition container definitions should be checked for host mode
Description: Check if Amazon Elastic Container Service (Amazon ECS) task definition with host networking mode has 'privileged' or 'user' container definitions.The rule is non compliant for task definitions with host network mode and container definitions of privileged=false or empty and user=root or empty.
Query:
    ID: ""
    Engine: odysseus-v0.0.1
    QueryToExecute: "with host_network_task_definition as (\n  select\n    distinct task_definition_arn as arn\n  from\n    aws_ecs_task_definition,\n    jsonb_array_elements(container_definitions) as c\n  where\n    network_mode = 'host'\n    and\n      (c ->> 'Privileged' is not null\n        and c ->> 'Privileged' <> 'false'\n      )\n    and\n      ( c ->> 'User' is not null\n      and c ->> 'User' <> 'root'\n      )\n)\nselect\n  a.task_definition_arn as resource,\n  a.kaytu_account_id as kaytu_account_id,\n  a.kaytu_resource_id as kaytu_resource_id,\n  case\n    when a.network_mode is null or a.network_mode <> 'host' then 'skip'\n    when b.arn is not null then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when a.network_mode is null or a.network_mode <> 'host' then a.title || ' not host network mode.'\n    when b.arn is not null then a.title || ' have secure host network mode.'\n    else a.title || ' not have secure host network mode.'\n  end as reason\n  \n  , region, account_id\nfrom\n  aws_ecs_task_definition as a\n  left join host_network_task_definition as b on a.task_definition_arn = b.arn;\n"
    Connector: AWS
    PrimaryTable: aws_ecs_task_definition
    ListOfTables:
        - aws_ecs_task_definition
    Parameters: []
ManualVerification: false
Severity: high
Tags:
    category:
        - Compliance
    cis_controls_v8_ig1:
        - "true"
    cisa_cyber_essentials:
        - "true"
    fedramp_low_rev_4:
        - "true"
    fedramp_moderate_rev_4:
        - "true"
    ffiec:
        - "true"
    gxp_21_cfr_part_11:
        - "true"
    hipaa_final_omnibus_security_rule_2013:
        - "true"
    nist_800_53_rev_5:
        - "true"
    nist_800_171_rev_2:
        - "true"
    nist_csf:
        - "true"
    plugin:
        - aws
    service:
        - AWS/ECS
Managed: false
