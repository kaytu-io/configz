{
  "ID": "aws_cloudtrail_enabled_all_regions",
  "Title": "CloudTrail should be enabled",
  "Description": "This control checks whether CloudTrail is enabled in your AWS account. However, some AWS services do not enable logging of all APIs and events. You should implement any additional audit trails other than CloudTrail and review the documentation for each service.",
  "Query": {
    "Engine": "odysseus-v0.0.1",
    "QueryToExecute": "with trail_details as (\n  select\n    name as trail_name,\n    arn,\n    is_multi_region_trail,\n    is_logging,\n    event_selectors,\n    e ->> 'ReadWriteType' as read_write_type,\n    account_id,\n    kaytu_account_id as kaytu_account_id,\n    kaytu_resource_id as kaytu_resource_id,\n    region\n  from\n    aws_cloudtrail_trail,\n    jsonb_array_elements(event_selectors) as e\n)\nselect\n  -- Required Columns\n  arn as resource,\n  kaytu_account_id as kaytu_account_id,\n  kaytu_resource_id as kaytu_resource_id,\n  case\n    when not trail_details.is_multi_region_trail then 'alarm'\n    when not trail_details.is_logging then 'alarm'\n    when read_write_type <> 'All' then 'alarm'\n    else 'ok'\n  end as status,\n  trail_details.trail_name ||\n    case when trail_details.is_multi_region_trail then ' is ' else ' is not ' end || 'multi-region,' ||\n    case when trail_details.is_logging then ' logging enabled' else ' logging disabled' end ||\n    ' for ' || read_write_type || ' events.'\n  as reason,\n  -- Additional Dimensions\n  region,\n  account_id\nfrom\n  trail_details\n",
    "Connector": "AWS",
    "PrimaryTable": "aws_cloudtrail_trail",
    "ListOfTables": [
      "aws_cloudtrail_trail"
    ]
  },
  "ManualVerification": false,
  "Severity": "low",
  "Tags": {
    "pci": [
      "true"
    ],
    "pci_item_id": [
      "cloudtrail_2"
    ],
    "pci_requirements": [
      "10.1,10.2.1,10.2.2,10.2.3,10.2.4,10.2.5,10.2.6,10.2.7,10.3.1,10.3.2,10.3.3,10.3.4,10.3.5,10.3.6"
    ],
    "pci_version": [
      "v3.2.1"
    ],
    "plugin": [
      "aws"
    ],
    "service": [
      "cloudtrail"
    ]
  },
  "Managed": true
}