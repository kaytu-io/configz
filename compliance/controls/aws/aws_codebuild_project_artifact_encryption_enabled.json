{
  "ID": "aws_codebuild_project_artifact_encryption_enabled",
  "Title": "CodeBuild project artifact encryption should be enabled",
  "Description": "This control checks if a CodeBuild project has encryption enabled for all of its artifacts. The rule is non compliant if 'encryptionDisabled' is set to 'true' for any primary or secondary (if present) artifact configurations.",
  "Query": {
    "Engine": "odysseus-v0.0.1",
    "QueryToExecute": "with secondary_artifact as (\n  select\n    distinct arn\n  from\n    aws_codebuild_project,\n    jsonb_array_elements(secondary_artifacts) as a\n  where\n    a -> 'EncryptionDisabled' = 'true'\n)\nselect\n  a.arn as resource,\n  p.kaytu_account_id as kaytu_account_id,\n  p.kaytu_resource_id as kaytu_resource_id,\n  case\n    when p.artifacts ->> 'EncryptionDisabled' = 'false'\n    and (p.secondary_artifacts is null or a.arn is null) then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when p.artifacts ->> 'EncryptionDisabled' = 'false'\n    and (p.secondary_artifacts is null or a.arn is null) then p.title || ' all artifacts encryption enabled.'\n    else p.title || ' all artifacts encryption not enabled.'\n  end as reason\n  \n  , p.region, p.account_id\nfrom\n  aws_codebuild_project as p\n  left join secondary_artifact as a on a.arn = p.arn;\n",
    "Connector": "AWS",
    "PrimaryTable": "aws_codebuild_project",
    "ListOfTables": [
      "aws_codebuild_project"
    ]
  },
  "ManualVerification": false,
  "Severity": "",
  "Tags": {
    "category": [
      "Compliance"
    ],
    "cis_controls_v8_ig1": [
      "true"
    ],
    "gxp_21_cfr_part_11": [
      "true"
    ],
    "gxp_eu_annex_11": [
      "true"
    ],
    "nist_csf": [
      "true"
    ],
    "plugin": [
      "aws"
    ],
    "service": [
      "AWS/CodeBuild"
    ]
  },
  "Managed": true
}