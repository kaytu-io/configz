Description: Client certificates allow for the app to request a certificate for incoming requests. Only clients that have a valid certificate will be able to reach the app.
DocumentURI: ""
ID: azure_appservice_web_app_incoming_client_cert_on
Managed: true
ManualVerification: false
Query:
  Connector: Azure
  Engine: odysseus-v0.0.1
  ListOfTables:
  - azure_app_service_web_app
  - azure_subscription
  PrimaryTable: azure_app_service_web_app
  QueryToExecute: |
    select
      app.id as resource,
      app.kaytu_account_id as kaytu_account_id,
      app.kaytu_resource_id as kaytu_resource_id,
      case
        when not client_cert_enabled then 'alarm'
        else 'ok'
      end as status,
      case
        when not client_cert_enabled then name || ' incoming client certificates set to off.'
        else name || ' incoming client certificates set to on.'
      end as reason
      
      , app.resource_group as resource_group
      , sub.display_name as subscription
    from
      azure_app_service_web_app as app,
      azure_subscription as sub
    where
      sub.subscription_id = app.subscription_id;
Severity: medium
Tags:
  category:
  - Compliance
  cis:
  - "true"
  cis_item_id:
  - "9.4"
  cis_level:
  - "2"
  cis_section_id:
  - "9"
  cis_type:
  - automated
  cis_version:
  - v1.3.0
  plugin:
  - azure
  service:
  - Azure/AppService
  x-kaytu-explanation:
  - |-
    Client certificates are a type of digital certificate that allows a client (like a user's browser) to authenticate itself with a server (like your Azure app). This certificate provides proof of the client's identity and ensures the server that the client can be trusted.

    In the context of Azure, client certificates are used to secure access to web apps, API apps, or function apps in Azure App Service. When you enable client certificate authentication in Azure, your app will request a client certificate from each client that tries to establish a connection. 

    Here's how it would look in Azure's application settings in a markup format:

    ```xml
    <system.webServer>
        <security>
            <access sslFlags="SslNegotiateCert" />
        </security>
    </system.webServer>
    ```

    In this markup:
    - `<system.webServer>` element specifies settings for IIS 7.0 that are applied to the Web server.
    - `<security>` element specifies settings for IIS 7.0 security features such as IP and domain restrictions, request filtering, and URL authorization.
    - `<access>` element specifies the SSL security settings for IIS 7.0. Here, `sslFlags="SslNegotiateCert"` means that the Microsoft Internet Information Services (IIS) will try to negotiate a client certificate.

    The use of client certificates provides an added layer of security by ensuring only those clients possessing a valid certificate can access your Azure application. This can help protect your app from unauthorized access or malicious attacks.
  x-kaytu-noncompliance-cost:
  - |-
    Non-compliance to the Azure control that requires the use of client certificates can lead to several risks and potential costs. Here is a breakdown:

    1. **Security Vulnerabilities:**
    Without client certificates, unauthorized clients can access the app, leading to potential data breaches or malicious activities. This makes the system susceptible to digital fraud and hacking attempts.

    2. **Violations of Regulations and Standards:**
    Several industry standards and regulations require secure communication between applications and their clients. Non-compliance can lead to violations, resulting in heavy fines and penalties, loss of certifications, and in extreme cases, business closure.

    3. **Loss of Trust and Reputation:**
    With increased attention on data privacy and digital security, any breach or perceived lack of security measures (including lacking client certificates) can hurt a company's reputation resulting in loss of customers, partners, and revenue.

    4. **Potential Business Disruptions:**
    In a case of a data breach or hacking attempt, the targeted application might need to be taken down for audit, investigation, and remedy, disrupting the normal course of business.

    5. **Increased Recovery Costs:**
    Apart from potential fines and penalties, companies would need to invest in troubleshooting, security upgrades, crisis management, PR efforts to restore customer confidence, and potential compensation for affected parties.

    In summary, a lack of compliance in requiring client certificates can result in significant financial costs and reputational damage, making it vital for companies to ensure adherence to this Azure control.
  x-kaytu-usefulness-example:
  - |-
    For example, suppose you have a web application hosted on Azure App Service that holds sensitive financial data. You want to enforce secure access to this app, ensuring that only authorized clients can access it.

    First, you can use Azure to create client certificates for the valid clients. These certificates will then be used to authenticate these clients.

    ```xml
    <system.webServer>
     <security>
      <access sslFlags="Ssl, SslNegotiateCert" />
     </security>
    </system.webServer>
    ```
    The above markup sets the SSL flags to accept SSL connections and negotiate client certification.

    When a client tries to access the app, it will present the certificate, and then Azure verifies the certificate details. If the certificate is valid, Azure will allow the client to communicate and interact with the app. If the certificate is not valid or absent, Azure blocks the client from accessing the app.

    This way, the use of client certificates as an Azure control can ensure that sensitive apps are accessed only by authenticated and authorized entities, adding an extra layer of security for applications hosted on Azure. Any unauthorized entity will be denied access, protecting the sensitive data contained within the application.
Title: Ensure the web app has 'Client Certificates (Incoming client certificates)' set to 'On'
