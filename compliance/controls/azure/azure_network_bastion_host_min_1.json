{
  "ID": "azure_network_bastion_host_min_1",
  "Title": "Ensure an Azure Bastion Host Exists",
  "Description": "The Azure Bastion service allows secure remote access to Azure Virtual Machines over the Internet without exposing remote access protocol ports and services directly to the Internet. The Azure Bastion service provides this access using TLS over 443/TCP, and subscribes to hardened configurations within an organization's Azure Active Directory service.",
  "Query": {
    "Engine": "odysseus-v0.0.1",
    "QueryToExecute": "with bastion_hosts as (\n  select\n    subscription_id,\n    _ctx,\n    region,\n    resource_group,\n    count(*) as no_bastion_host\n  from\n    azure_bastion_host\n  group by\n    subscription_id,\n    _ctx,\n    resource_group,\n    region\n)\nselect\n  sub.id as resource,\n  sub.kaytu_account_id as kaytu_account_id,\n  sub.kaytu_resource_id as kaytu_resource_id,\n  case\n    when i.subscription_id is null then 'alarm'\n    else 'ok'\n  end as status,\n  case\n    when i.subscription_id is null then sub.display_name || ' does not have bastion host.'\n    else sub.display_name || ' has ' || no_bastion_host || ' bastion host(s).'\n  end as reason\n  , i.resource_group as resource_group\n  , sub.display_name as subscription\nfrom\n  azure_subscription as sub\n  left join bastion_hosts as i on i.subscription_id = sub.subscription_id;\n",
    "Connector": "Azure",
    "PrimaryTable": "azure_bastion_host",
    "ListOfTables": [
      "azure_bastion_host",
      "azure_subscription"
    ]
  },
  "ManualVerification": false,
  "Severity": "medium",
  "Tags": {
    "category": [
      "Compliance"
    ],
    "cis": [
      "true"
    ],
    "cis_item_id": [
      "7.1"
    ],
    "cis_level": [
      "2"
    ],
    "cis_section_id": [
      "7"
    ],
    "cis_type": [
      "automated"
    ],
    "cis_version": [
      "v2.0.0"
    ],
    "plugin": [
      "azure"
    ],
    "service": [
      "Azure/Compute"
    ]
  },
  "Managed": true
}