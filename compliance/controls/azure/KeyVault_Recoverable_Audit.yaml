Description: Malicious deletion of a key vault can lead to permanent data loss. You
  can prevent permanent data loss by enabling purge protection and soft delete. Purge
  protection protects you from insider attacks by enforcing a mandatory retention
  period for soft deleted key vaults. No one inside your organization or Microsoft
  will be able to purge your key vaults during the soft delete retention period. Keep
  in mind that key vaults created after September 1st 2019 have soft-delete enabled
  by default.
ID: key_vaults_should_have_deletion_protection_enabled
Query:
  Connector: Azure
  Engine: odysseus-v0.0.1
  QueryToExecute: "SELECT name, create_mode, purge_protection_enabled, soft_delete_enabled\n\
    FROM azure_key_vault\nWHERE type = 'Microsoft.KeyVault/vaults'\nAND (create_mode\
    \ IS NOT NULL AND create_mode != 'recover')\nAND (\n    (\n        (kaytu_description\
    \ -> 'definitions' -> 'Vault' -> 'properties' -> 'properties' ->> 'createMode')\
    \ IS NOT NULL\n        AND (kaytu_description -> 'definitions' -> 'Vault' -> 'properties'\
    \ -> 'properties' ->> 'createMode') != 'recover'\n    )\n    OR\n    (\n     \
    \   (kaytu_description -> 'definitions' -> 'Vault' -> 'properties' -> 'properties'\
    \ ->> 'enablePurgeProtection') IS NOT NULL\n        AND (kaytu_description ->\
    \ 'definitions' -> 'Vault' -> 'properties' -> 'properties' ->> 'enablePurgeProtection')\
    \ = 'false'\n    )\n    OR\n    (\n        (kaytu_description -> 'definitions'\
    \ -> 'Vault' -> 'properties' -> 'properties' ->> 'enableSoftDelete') IS NOT NULL\n\
    \        AND (kaytu_description -> 'definitions' -> 'Vault' -> 'properties' ->\
    \ 'properties' ->> 'enableSoftDelete') = 'false'\n    )\n)\nLIMIT 5;;\n"
Severity: ''
Title: Key vaults should have deletion protection enabled
