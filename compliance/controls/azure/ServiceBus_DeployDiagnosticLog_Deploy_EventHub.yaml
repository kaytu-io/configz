Description: Deploys the diagnostic settings for Service Bus to stream to a regional
  Event Hub when any Service Bus which is missing this diagnostic settings is created
  or updated.
ID: deploy_diagnostic_settings_for_service_bus_to_event_hub
Query:
  Connector: Azure
  Engine: odysseus-v0.0.1
  QueryToExecute: 'SELECT name, location, kaytu_description

    FROM azure_servicebus_namespace

    WHERE type = ''Microsoft.ServiceBus/namespaces''

    AND (location = ''[parameters(''eventHubLocation'')]'' OR kaytu_description ->>
    ''location'' = ''[parameters(''eventHubLocation'')]'')

    AND (kaytu_description -> ''ServicebusNamespaceDescription'' -> ''DiagnosticSettingsResources''
    ->> ''Logs'' ?| array[''{"Enabled": true}''] OR kaytu_description -> ''Microsoft.Insights/diagnosticSettings/logs.enabled''
    ?| array[''true''])

    AND (kaytu_description -> ''ServicebusNamespaceDescription'' -> ''DiagnosticSettingsResources''
    ->> ''Metrics'' ?| array[''{"Enabled": true}''] OR kaytu_description -> ''Microsoft.Insights/diagnosticSettings/metrics.enabled''
    ?| array[''true''])

    LIMIT 5;;

    '
Severity: ''
Title: Deploy Diagnostic Settings for Service Bus to Event Hub
