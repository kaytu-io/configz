{
  "ID": "azure_cosmosdb_account_with_firewall_rules",
  "Title": "Azure Cosmos DB accounts should have firewall rules",
  "Description": "Firewall rules should be defined on your Azure Cosmos DB accounts to prevent traffic from unauthorized sources. Accounts that have at least one IP rule defined with the virtual network filter enabled are deemed compliant. Accounts disabling public access are also deemed compliant.",
  "Query": {
    "Engine": "odysseus-v0.0.1",
    "QueryToExecute": "select\n  a.id as resource,\n  case\n    when\n      public_network_access = 'Enabled'\n      and is_virtual_network_filter_enabled = 'false'\n      and jsonb_array_length(ip_rules) = 0\n      then 'alarm'\n    else 'ok'\n  end as status,\n  case\n    when\n      public_network_access = 'Enabled'\n      and is_virtual_network_filter_enabled = 'false'\n      and jsonb_array_length(ip_rules) = 0\n      then a.name || ' not have firewall rules.'\n    else a.name || ' have firewall rules.'\n  end as reason\n  \n  , a.resource_group as resource_group\n  , sub.display_name as subscription\nfrom\n  azure_cosmosdb_account as a,\n  azure_subscription as sub\nwhere\n  sub.subscription_id = a.subscription_id;\n",
    "Connector": "Azure",
    "PrimaryTable": "azure_cosmosdb_account",
    "ListOfTables": [
      "azure_cosmosdb_account",
      "azure_subscription"
    ]
  },
  "ManualVerification": false,
  "Severity": "",
  "Tags": {
    "nist_sp_800_53_rev_5": [
      "true"
    ],
    "service": [
      "Azure/CosmosDB"
    ]
  },
  "Managed": true
}