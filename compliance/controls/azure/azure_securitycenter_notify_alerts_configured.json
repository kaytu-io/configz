{
  "ID": "azure_securitycenter_notify_alerts_configured",
  "Title": "Ensure that 'Notify about alerts with the following severity' is set to 'High'",
  "Description": "Enables emailing security alerts to the subscription owner or other designated security contact.",
  "Query": {
    "Connector": "Azure",
    "Engine": "odysseus-v0.0.1",
    "ListOfTables": [
      "azure_security_center_contact",
      "azure_subscription"
    ],
    "PrimaryTable": "azure_security_center_contact",
    "QueryToExecute": "with contact_info as (\n  select\n    count(*) filter (where alert_notifications = 'On') as notification_alert_count,\n    subscription_id\n  from\n    azure_security_center_contact\n  group by\n    subscription_id\n  limit 1\n)\nselect\n  sub.subscription_id as resource,\n  sub.kaytu_account_id as kaytu_account_id,\n  sub.kaytu_resource_id as kaytu_resource_id,\n  case\n    when notification_alert_count \u003e 0 then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when notification_alert_count \u003e 0 then '\"Notify about alerts with the following severity\" set to High.'\n    else '\"Notify about alerts with the following severity\" not set to High.'\n  end as reason\n  \n  , sub.display_name as subscription\nfrom\n  azure_subscription sub\n  left join contact_info ci on sub.subscription_id = ci.subscription_id;\n"
  },
  "DocumentURI": "",
  "ManualVerification": false,
  "Severity": "low",
  "Tags": {
    "category": [
      "Compliance"
    ],
    "cis": [
      "true"
    ],
    "cis_item_id": [
      "2.14"
    ],
    "cis_level": [
      "1"
    ],
    "cis_section_id": [
      "2"
    ],
    "cis_type": [
      "automated"
    ],
    "cis_version": [
      "v1.3.0"
    ],
    "plugin": [
      "azure"
    ],
    "service": [
      "Azure/SecurityCenter"
    ],
    "x-kaytu-explanation": [
      "## Azure Control: Email Security Alerts\n\nThe **Email Security Alerts** Azure Control facilitates the sending of security alerts via email to the subscription owner or any other specified security contact. This control plays a crucial role in keeping stakeholders informed about potential security threats and incidents within the Azure environment.\n\n### Functionality:\n\n- **Alert Notification:**\n  - The control monitors security-related events within the Azure subscription.\n  - When a security event is detected, the control triggers an alert notification process.\n\n- **Recipient Designation:**\n  - The subscription owner is automatically designated as a primary recipient.\n  - Additionally, a designated security contact can be configured to receive alerts.\n\n- **Email Delivery:**\n  - Security alerts are delivered via email to the specified recipients.\n  - Email notifications include essential details about the security event, allowing for prompt assessment and response.\n\n### Configuration:\n\nTo configure the **Email Security Alerts** Azure Control, follow these steps:\n\n1. **Subscription Owner:**\n   - The subscription owner is automatically set as the primary recipient. Ensure that the contact details are up-to-date.\n\n2. **Designate Security Contact:**\n   - Specify a designated security contact who will also receive email alerts. This can be configured through Azure portal settings.\n\n3. **Alert Thresholds:**\n   - Define the criteria for triggering security alerts, such as specific types of security events or severity levels.\n\n### Benefits:\n\n- **Timely Response:**\n  - Enables quick response to security incidents by promptly notifying stakeholders.\n\n- **Customization:**\n  - Allows customization of alert criteria, ensuring that relevant security events trigger notifications.\n\n- **Visibility:**\n  - Enhances visibility into security incidents, promoting a proactive approach to security management.\n\n### Example Usage:\n\n```yaml\nazure_control:\n  name: Email Security Alerts\n  description: Enables emailing security alerts to the subscription owner or other designated security contact.\n  functionality:\n    - Alert Notification\n    - Recipient Designation\n    - Email Delivery\n  configuration:\n    - Subscription Owner\n    - Designate Security Contact\n    - Alert Thresholds\n  benefits:\n    - Timely Response\n    - Customization\n    - Visibility\n"
    ],
    "x-kaytu-noncompliance-cost": [
      "**Azure Security Center Email Notification Control**\n\n*Description:*\nEnables emailing security alerts to the subscription owner or other designated security contact.\n\n*Cost of Non-Compliance:*\n- **Security Risks:** Failure to comply may result in missed security alerts, leaving the subscription vulnerable to potential threats.\n- **Delayed Incident Response:** Without timely email notifications, the detection and response to security incidents may be delayed, allowing attackers more time to exploit vulnerabilities.\n- **Regulatory Fines:** Non-compliance with security controls, especially those related to notification and incident response, may lead to regulatory violations and fines.\n\n*Recommendation:*\nTo ensure compliance, regularly review and configure the email notification settings in Azure Security Center. Designate appropriate security contacts and verify that alert emails are being sent and received effectively.\n\n"
    ],
    "x-kaytu-usefulness-example": [
      "Here's an example:\n\n\n{\n  \"mode\": \"All\",\n  \"policyRule\": {\n    \"if\": {\n      \"field\": \"type\",\n      \"equals\": \"Microsoft.Security/assessments\",\n      \"not\": {\n        \"field\": \"Microsoft.Security/assessments/status\",\n        \"equals\": \"Healthy\"\n      }\n    },\n    \"then\": {\n      \"effect\": \"deployIfNotExists\",\n      \"details\": {\n        \"type\": \"Microsoft.Insights/alertRules\",\n        \"name\": \"EmailSecurityAlerts\",\n        \"existenceCondition\": {\n          \"field\": \"Microsoft.Insights/alertRules/actions/actionGroups\",\n          \"exists\": true\n        },\n        \"deployment\": {\n          \"properties\": {\n            \"mode\": \"incremental\",\n            \"template\": {\n              \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n              \"contentVersion\": \"1.0.0.0\",\n              \"resources\": [\n                {\n                  \"type\": \"Microsoft.Insights/alertRules\",\n                  \"apiVersion\": \"2018-03-01\",\n                  \"name\": \"EmailSecurityAlerts\",\n                  \"location\": \"[parameters('location')]\",\n                  \"properties\": {\n                    \"actions\": [\n                      {\n                        \"actionGroupId\": \"[parameters('securityAlertsActionGroupId')]\"\n                      }\n                    ],\n                    \"conditions\": {\n                      \"allOf\": [\n                        {\n                          \"field\": \"category\",\n                          \"equals\": \"Security\"\n                        }\n                      ]\n                    },\n                    \"description\": \"Alert rule for security assessments\",\n                    \"enabled\": true\n                  }\n                }\n              ]\n            }\n          }\n        }\n      }\n    }\n  }\n}\nIn this example:\n\nThe policy checks if there are any security assessments that are not in a \"Healthy\" state.\nIf any non-healthy assessments are found, it triggers the deployment of an Azure Monitor alert rule named \"EmailSecurityAlerts.\"\nThe alert rule is configured to send emails to the designated security contact or owner.\nNote: The actual implementation might vary based on your specific requirements and environment configurations. Always refer to the latest Azure Policy documentation for accurate and up-to-date information."
    ]
  },
  "Managed": true
}