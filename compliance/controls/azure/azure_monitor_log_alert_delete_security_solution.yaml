Description: Create an activity log alert for the Delete Security Solution event.
DocumentURI: ""
ID: azure_monitor_log_alert_delete_security_solution
Managed: true
ManualVerification: false
Query:
  Connector: Azure
  Engine: odysseus-v0.0.1
  ListOfTables:
  - azure_log_alert
  - azure_subscription
  PrimaryTable: azure_log_alert
  QueryToExecute: "with alert_rule as (\n  select\n    alert.id as alert_id,\n    alert.name as alert_name,\n    alert.enabled,\n    alert.location,\n    alert.subscription_id\n  from\n    azure_log_alert as alert,\n    jsonb_array_elements_text(scopes) as sc\n  where\n    alert.location = 'Global'\n    and alert.enabled\n    and sc = '/subscriptions/' || alert.subscription_id\n    and (\n      (\n        alert.condition -> 'allOf' @> '[{\"equals\":\"Security\",\"field\":\"category\"}]'\n        and alert.condition -> 'allOf' @> '[{\"field\": \"resourceType\", \"equals\": \"microsoft.security/securitysolutions\"}]'\n        and alert.condition -> 'allOf' @> '[{\"field\": \"operationName\", \"equals\": \"Microsoft.Security/securitySolutions/delete\"}]'\n      )\n      or\n      (\n        alert.condition -> 'allOf' @> '[{\"equals\":\"Security\",\"field\":\"category\"}]'\n        and alert.condition -> 'allOf' @> '[{\"field\": \"resourceType\", \"equals\": \"microsoft.security/securitysolutions\"}]'\n        and jsonb_array_length(alert.condition -> 'allOf') = 2\n      )\n    )\n  limit 1\n)\nselect\n  sub.subscription_id as resource,\n  sub.kaytu_account_id as kaytu_account_id,\n  sub.kaytu_resource_id as kaytu_resource_id,\n  case\n    when count(a.subscription_id) > 0 then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when count(a.subscription_id) > 0 then 'Activity log alert exists for delete Security Solution event.'\n    else 'Activity log alert does not exists for delete Security Solution event.'\n  end as reason\n  \n  , sub.display_name as subscription\nfrom\n  azure_subscription sub\n  left join alert_rule a on sub.subscription_id = a.subscription_id\ngroup by\n  sub.kaytu_account_id,\n  sub.kaytu_resource_id,\n  sub._ctx,\n  sub.subscription_id,\n  sub.display_name;\n"
Severity: high
Tags:
  category:
  - Compliance
  cis:
  - "true"
  cis_item_id:
  - 5.2.8
  cis_level:
  - "1"
  cis_section_id:
  - "5.2"
  cis_type:
  - automated
  cis_version:
  - v1.3.0
  plugin:
  - azure
  service:
  - Azure/Monitor
  x-kaytu-explanation:
  - "# Azure Activity Log Alert Configuration\n\n## Objective\nCreate an activity log alert in Azure to be notified whenever a \"Delete Security Solution\" event occurs.\n\n## Steps\n\n1. **Navigate to Azure Portal:**\n   - Open your web browser and go to the [Azure Portal](https://portal.azure.com/).\n\n2. **Access Activity Log:**\n   - In the left navigation pane, select \"Monitor\" and then choose \"Activity log.\"\n\n3. **Filter Activity Log Events:**\n   - Use the filtering options to narrow down the events. In the \"Event name\" filter, enter \"Delete Security Solution\" to focus on relevant events.\n\n4. **Create Alert Rule:**\n   - Click on the \"Alerts\" section in the Activity Log blade.\n   - Select \"New alert rule.\"\n\n5. **Define Condition:**\n   - In the \"Create alert rule\" blade, set the condition for the alert.\n     - Choose \"Custom log search\" as the signal type.\n     - Define the query to filter events related to the \"Delete Security Solution\" action.\n\n     ```kql\n     resourceType == \"Microsoft.Security/solutions\" and operationName == \"Microsoft.Security/solutions/delete\"\n     ```\n\n6. **Configure Alert Details:**\n   - Provide a meaningful name for the alert rule.\n   - Set the severity level based on the importance of the event.\n   - Specify the alert action group for notification.\n\n7. **Define Actions:**\n   - Choose the action to be taken when the alert condition is met. Options include sending an email, triggering a webhook, etc.\n\n8. **Review and Create:**\n   - Review the alert rule configuration to ensure accuracy.\n   - Click \"Create\" to save and activate the alert rule.\n\n9. **Verification:**\n   - To verify the alert, intentionally delete a security solution and check if the alert is triggered according to the defined conditions.\n\n## Conclusion\nBy following these steps, you have successfully created an activity log alert in Azure that notifies you whenever a \"Delete Security Solution\" event occurs. This helps in proactively monitoring and responding to critical actions within your Azure environment.\n"
  x-kaytu-noncompliance-cost:
  - "# Cost of Non-Compliance: Azure Control - Activity Log Alert for Delete Security Solution Event\n\n## Control Description\nThe Azure control mandates the creation of an activity log alert specifically for the \"Delete Security Solution\" event. This is crucial for monitoring and responding to activities that could potentially compromise the security of the Azure environment.\n\n## Risks and Consequences of Non-Compliance\n\n### 1. Security Breach\n- **Risk**: Without an alert for the \"Delete Security Solution\" event, unauthorized deletions may go unnoticed.\n- **Consequence**: Increased vulnerability to security breaches, potential data loss, and unauthorized access.\n\n### 2. Lack of Visibility\n- **Risk**: Absence of real-time alerts hampers the ability to promptly detect and respond to security incidents.\n- **Consequence**: Reduced visibility into critical security events, delaying incident response and mitigation efforts.\n\n### 3. Compliance Violation\n- **Risk**: Non-compliance with Azure security controls may lead to regulatory and legal repercussions.\n- **Consequence**: Fines, legal actions, and damage to the organization's reputation due to failure to meet compliance standards.\n\n### 4. Operational Disruption\n- **Risk**: Failure to monitor and alert on critical events may result in operational disruptions.\n- **Consequence**: Downtime, loss of productivity, and potential financial losses due to disruptions in Azure services.\n\n## Cost of Non-Compliance Mitigation\n\nTo mitigate the cost of non-compliance, it is imperative to:\n1. **Implement Activity Log Alerts**: Set up alerts specifically for the \"Delete Security Solution\" event in Azure Activity Log.\n2. **Define Response Procedures**: Establish clear procedures for responding to alerts, including incident investigation and resolution.\n3. **Regular Audits and Reviews**: Conduct regular audits to ensure that the alerting system is functioning effectively and review alert configurations for relevance.\n\n## Conclusion\n\nFailing to comply with the Azure control regarding activity log alerts for the \"Delete Security Solution\" event exposes the organization to significant risks. Proactive measures, including robust alerting systems and adherence to security best practices, are essential to safeguard Azure environments and maintain regulatory compliance.\n"
  x-kaytu-usefulness-example:
  - "## Create Activity Log Alert for Delete Security Solution Event\n\n### Overview\n\nThis example demonstrates how to create an Activity Log Alert in Azure to monitor and be notified when the \"Delete Security Solution\" event occurs.\n\n### Azure Policy Definition\n\n```json\n{\n  \"mode\": \"All\",\n  \"policyRule\": {\n    \"if\": {\n      \"field\": \"category\",\n      \"in\": [\n        \"Administrative\"\n      ],\n      \"and\": [\n        {\n          \"field\": \"operationName\",\n          \"equals\": \"Microsoft.Security/securitySolutions/delete\"\n        }\n      ]\n    },\n    \"then\": {\n      \"effect\": \"audit\"\n    }\n  }\n}\n"
Title: Ensure that Activity Log Alert exists for Delete Security Solution
