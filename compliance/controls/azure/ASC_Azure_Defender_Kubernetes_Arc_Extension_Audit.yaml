Description: Microsoft Defender for Cloud extension for Azure Arc provides threat
  protection for your Arc enabled Kubernetes clusters. The extension collects data
  from all nodes in the cluster and sends it to the Azure Defender for Kubernetes
  backend in the cloud for further analysis. Learn more in https://docs.microsoft.com/azure/defender-for-cloud/defender-for-containers-enable?pivots=defender-for-container-arc.
ID: '[_preview]:_azure_arc_enabled_kubernetes_clusters_should_have_microsoft_defender_for_cloud_extension_installed'
Query:
  Connector: Azure
  Engine: odysseus-v0.0.1
  QueryToExecute: "SELECT *\nFROM azure_hybrid_kubernetes_connected_cluster\nWHERE\
    \ type = 'Microsoft.Kubernetes/connectedClusters'\nAND (\n    (distribution NOT\
    \ IN ('aks', 'aks_management', 'eks', 'gke') AND connectivity_status = 'connected')\n\
    \    OR\n    (\n        kaytu_description -> 'ConnectedCluster' -> 'Properties'\
    \ ->> 'Distribution' NOT IN ('aks', 'aks_management', 'eks', 'gke')\n        AND\n\
    \        kaytu_description -> 'ConnectedCluster' -> 'Properties' ->> 'ConnectivityStatus'\
    \ = 'connected'\n        AND\n        kaytu_description -> 'ConnectedClusterExtensions'\
    \ ?| array['Microsoft.KubernetesConfiguration']\n        AND\n        (kaytu_description\
    \ -> 'ConnectedClusterExtensions' -> 0 -> 'Properties' ->> 'ProvisioningState')\
    \ = 'Succeeded'\n        AND\n        (kaytu_description -> 'ConnectedClusterExtensions'\
    \ -> 0 -> 'Properties' ->> 'ExtensionType') = 'microsoft.azuredefender.kubernetes'\n\
    \    )\n)\nLIMIT 5;;\n"
Severity: ''
Title: '[Preview]: Azure Arc enabled Kubernetes clusters should have Microsoft Defender
  for Cloud extension installed'
