Description: Disable SSH access on network security groups from the Internet.
DocumentURI: ""
ID: azure_network_security_group_ssh_access_restricted
Managed: true
ManualVerification: false
Query:
  Connector: Azure
  Engine: odysseus-v0.0.1
  ListOfTables:
  - azure_network_security_group
  - azure_subscription
  PrimaryTable: azure_network_security_group
  QueryToExecute: "with network_sg as (\n  select\n    distinct name sg_name\n  from\n    azure_network_security_group nsg,\n    jsonb_array_elements(security_rules) sg,\n    jsonb_array_elements_text(sg -> 'properties' -> 'destinationPortRanges' || (sg -> 'properties' -> 'destinationPortRange') :: jsonb) dport,\n    jsonb_array_elements_text(sg -> 'properties' -> 'sourceAddressPrefixes' || (sg -> 'properties' -> 'sourceAddressPrefix') :: jsonb) sip\n  where\n    sg -> 'properties' ->> 'access' = 'Allow'\n    and sg -> 'properties' ->> 'direction' = 'Inbound'\n    and (sg -> 'properties' ->> 'protocol' ilike 'TCP' or sg -> 'properties' ->> 'protocol' = '*')\n    and sip in ('*', '0.0.0.0', '0.0.0.0/0', 'Internet', 'any', '<nw>/0', '/0')\n    and (\n      dport in ('22', '*')\n      or (\n        dport like '%-%'\n        and split_part(dport, '-', 1) :: integer <= 22\n        and split_part(dport, '-', 2) :: integer >= 22\n      )\n    )\n)\nselect\n  sg.id resource,\n  sg.kaytu_account_id as kaytu_account_id,\n  sg.kaytu_resource_id as kaytu_resource_id,\n  case\n    when nsg.sg_name is null then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when nsg.sg_name is null\n      then sg.title || ' restricts SSH access from internet.'\n    else sg.title || ' allows SSH access from internet.'\n  end as reason\n  \n  , sg.resource_group as resource_group\n  , sub.display_name as subscription\nfrom\n  azure_network_security_group sg\n  left join network_sg nsg on nsg.sg_name = sg.name\n  join azure_subscription sub on sub.subscription_id = sg.subscription_id;\n"
Severity: high
Tags:
  category:
  - Compliance
  cis:
  - "true"
  cis_item_id:
  - "6.2"
  cis_level:
  - "1"
  cis_section_id:
  - "6"
  cis_type:
  - automated
  cis_version:
  - v1.3.0
  plugin:
  - azure
  service:
  - Azure/Network
  x-kaytu-explanation:
  - "# Disable SSH access on network security groups from the Internet\n\n## Description:\nThis Azure Control focuses on restricting SSH access to virtual machines by configuring network security groups (NSGs) to disallow incoming SSH traffic from the Internet.\n\n## Implementation Steps:\n\n1. Identify the NSGs associated with the relevant virtual machines.\n2. Modify the inbound security rules for SSH (port 22) to deny traffic from the Internet.\n3. Ensure that necessary exceptions are made for authorized IP addresses or services.\n4. Regularly audit and monitor NSG configurations to maintain security compliance.\n\n## Benefits:\n- Enhances security by preventing unauthorized SSH access.\n- Mitigates the risk of malicious activities and potential security breaches.\n\n## Risks of Non-Compliance:\nFailure to comply with this control may expose virtual machines to unauthorized access via SSH, leading to security vulnerabilities and potential data breaches.\n\n"
  x-kaytu-noncompliance-cost:
  - |
    The cost of non-compliance with the Azure Control "Disable SSH access on network security groups from the Internet" includes:

    Security Vulnerabilities:

    Unauthorized SSH access increases the risk of security breaches.
    Malicious actors may exploit this vulnerability to gain unauthorized control over virtual machines.
    Data Breach Risks:

    Non-compliance raises the potential for data breaches and exposure of sensitive information.
    Unauthorized SSH access can lead to the compromise of confidential data stored on virtual machines.
    Operational Disruption:

    Security incidents resulting from non-compliance can disrupt normal operations.
    Downtime, system unavailability, and service interruptions may occur as a consequence of security breaches.
    Reputation Damage:

    A security breach due to non-compliance can damage the reputation of the organization.
    Loss of customer trust and confidence may result from perceived inadequacies in data protection.
    Legal and Compliance Consequences:

    Non-compliance may lead to legal consequences and regulatory penalties.
    Organizations failing to secure SSH access may face fines and legal actions for violating data protection regulations.
  x-kaytu-usefulness-example:
  - "Consider a scenario where a company hosts a web application on Azure virtual machines. By implementing the Azure Control \"Disable SSH access on network security groups from the Internet,\" the organization ensures:\n\nScenario: Preventing Unauthorized Access:\n\nWithout proper SSH controls, malicious actors could attempt to gain unauthorized access to the virtual machines hosting the web application.\nThe organization configures NSGs to deny inbound SSH traffic from the Internet, limiting access only to authorized users or specific IP addresses.\nUsefulness:\n\nThe Azure Control enhances security by preventing unauthorized SSH access attempts.\nOnly authorized personnel with specified access rights can manage and administer the virtual machines via SSH.\nThis control safeguards the web application, sensitive data, and the overall integrity of the hosting environment.\nResult:\n\nThe organization successfully mitigates the risk of unauthorized access, ensuring the secure and uninterrupted operation of the web application on Azure.\n"
Title: Ensure that SSH access is restricted from the internet
