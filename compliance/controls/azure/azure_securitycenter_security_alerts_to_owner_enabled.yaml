Description: Enable security alert emails to subscription owners.
DocumentURI: ""
ID: azure_securitycenter_security_alerts_to_owner_enabled
Managed: true
ManualVerification: false
Query:
  Connector: Azure
  Engine: odysseus-v0.0.1
  ListOfTables:
  - azure_security_center_contact
  - azure_subscription
  PrimaryTable: azure_security_center_contact
  QueryToExecute: |
    with contact_info as (
      select
        count(*) filter (where alerts_to_admins = 'On') as admin_alert_count,
        subscription_id
      from
        azure_security_center_contact
      group by
        subscription_id
      limit 1
    )
    select
      sub.subscription_id as resource,
      sub.kaytu_account_id as kaytu_account_id,
      sub.kaytu_resource_id as kaytu_resource_id,
      case
        when admin_alert_count > 0 then 'ok'
        else 'alarm'
      end as status,
      case
        when admin_alert_count > 0 then '"All users with the following roles" set to Owner'
        else '"All users with the following roles" not set to Owner.'
      end as reason
      
      , sub.display_name as subscription
    from
      azure_subscription sub
      left join contact_info ci on sub.subscription_id = ci.subscription_id;
Severity: medium
Tags:
  category:
  - Compliance
  cis:
  - "true"
  cis_item_id:
  - "2.15"
  cis_level:
  - "1"
  cis_section_id:
  - "2"
  cis_type:
  - automated
  cis_version:
  - v1.3.0
  plugin:
  - azure
  service:
  - Azure/SecurityCenter
  x-kaytu-explanation:
  - "## Azure Control: Enable Security Alert Emails\n\nThe Azure Control allows you to enable security alert emails for your Azure subscription. This feature enhances the security posture of your environment by providing timely notifications to subscription owners about potential security threats and incidents.\n\n### Configuration Steps\n\nTo activate security alert emails, follow these steps:\n\n1. **Sign in to the Azure Portal:**\n   - Open your web browser and navigate to [Azure Portal](https://portal.azure.com/).\n   - Sign in with your Azure account credentials.\n\n2. **Access Security Settings:**\n   - In the Azure Portal, locate and select the target subscription.\n   - Navigate to the **Security** or **Security Center** section.\n\n3. **Enable Security Alert Emails:**\n   - Look for the option related to security alert notifications.\n   - Toggle the switch or select the appropriate setting to enable security alert emails.\n\n4. **Configure Email Recipients:**\n   - Specify the email addresses of the subscription owners who should receive security alert notifications.\n\n5. **Save Changes:**\n   - Save your changes to apply the new configuration.\n\n### Benefits\n\nEnabling security alert emails provides the following benefits:\n\n- **Timely Notifications:** Receive real-time alerts about potential security threats.\n\n- **Proactive Security Measures:** Stay ahead of security incidents and take proactive measures to mitigate risks.\n\n- **Subscription Owner Awareness:** Ensure that subscription owners are promptly informed about security issues affecting their environment.\n\n### Example Markup Usage\n\n```\n## Enable Security Alert Emails\n\n1. Sign in to [Azure Portal](https://portal.azure.com/).\n2. Navigate to the **Security** or **Security Center** section.\n3. Enable security alert emails in the settings.\n4. Specify email addresses for notification recipients.\n5. Save changes.\n\n### Benefits\n\n- Timely Notifications\n- Proactive Security Measures\n- Subscription Owner Awareness\n"
  x-kaytu-noncompliance-cost:
  - |-
    The cost of non-compliance with the Azure control "Enable security alert emails to subscription owners" can have significant implications for the security posture of your Azure environment. Non-compliance may result in:

    Missed Security Alerts:
    Without enabling security alert emails, subscription owners may miss critical alerts related to potential security threats and incidents in their Azure environment.
    This can lead to delayed or no response to security incidents, increasing the risk of data breaches or unauthorized access.


    **Cost of Non-Compliance:**
    - Missed Security Alerts
      - Increased risk of data breaches
      - Delayed or no response to security incidents
    Lack of Timely Incident Response:
    Security alert emails are crucial for timely incident response, allowing subscription owners to take immediate action when security issues arise.
    Without this control, the incident response process may be hindered, leading to extended downtime and potential financial losses.


    **Cost of Non-Compliance:**
    - Lack of Timely Incident Response
      - Extended downtime
      - Potential financial losses
    Reduced Visibility into Security Events:
    Enabling security alert emails provides subscription owners with better visibility into security events, helping them stay informed about potential threats and vulnerabilities.
    Non-compliance may result in a lack of awareness regarding the security status of the Azure environment.


    **Cost of Non-Compliance:**
    - Reduced Visibility into Security Events
      - Lack of awareness regarding security status
      - Increased vulnerability to potential threats
    Compliance and Audit Risks:
    Failure to enable security alert emails may lead to non-compliance with regulatory requirements and industry standards.
    This could result in legal consequences, fines, and damage to the organization's reputation.


    **Cost of Non-Compliance:**
    - Compliance and Audit Risks
      - Legal consequences
      - Fines and penalties
      - Damage to reputation
    In summary, the cost of non-compliance with the "Enable security alert emails to subscription owners" control in Azure is multi-faceted, encompassing missed alerts, delayed incident response, reduced visibility, and potential compliance risks. It is essential to prioritize and implement this control to enhance the overall security posture of your Azure environment.
  x-kaytu-usefulness-example:
  - "Below is an example of how you might use markup to enable security alert emails to subscription owners in Azure:\n\n\n\nresources:\n  - type: Microsoft.Authorization/roleAssignments\n    apiVersion: '2018-09-01-preview'\n    name: assignSecurityAlertRole\n    properties:\n      principalId: <Subscription Owner's Object ID>\n      roleDefinitionId: 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx' # Replace with the appropriate role definition ID for Security Alert emails.\n      scope: '/'\n  - type: Microsoft.Security/locations/configurationSettings\n    apiVersion: '2020-01-01'\n    name: 'default'\n    properties:\n      isSendToOwnersOnAlert: true\nPlease note that in the principalId field, you need to replace <Subscription Owner's Object ID> with the actual Object ID of the subscription owner. Additionally, replace 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx' with the correct role definition ID for enabling security alert emails. Ensure you have the necessary permissions to make these changes in your Azure environment.\n\nThis example assumes you're using Azure Resource Manager (ARM) templates in  format to define your Azure resources and configurations. Adjustments may be needed based on your specific deployment and infrastructure requirements."
Title: Ensure that 'All users with the following roles' is set to 'Owner'
