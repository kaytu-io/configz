{
  "ID": "azure_cosmosdb_account_virtual_network_filter_enabled",
  "Title": "Ensure That 'Firewalls \u0026 Networks' Is Limited to Use Selected Networks Instead of All Networks",
  "Description": "",
  "Query": {
    "Connector": "Azure",
    "Engine": "odysseus-v0.0.1",
    "ListOfTables": [
      "azure_cosmosdb_account",
      "azure_subscription"
    ],
    "PrimaryTable": "azure_cosmosdb_account",
    "QueryToExecute": "select\n  a.id as resource,\n  a.kaytu_account_id as kaytu_account_id,\n  a.kaytu_resource_id as kaytu_resource_id,\n  case\n    when public_network_access = 'Disabled' then 'ok'\n    when public_network_access = 'Enabled' and is_virtual_network_filter_enabled = 'true' then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when public_network_access = 'Disabled' then a.name || ' public network access disabled.'\n    when public_network_access = 'Enabled' and is_virtual_network_filter_enabled = 'true' then a.name || ' virtual network filter enabled.'\n    else a.name || ' virtual network filter disabled.'\n  end as reason\n  \n  , a.resource_group as resource_group\n  , sub.display_name as subscription\nfrom\n  azure_cosmosdb_account as a,\n  azure_subscription as sub\nwhere\n  sub.subscription_id = a.subscription_id;\n"
  },
  "DocumentURI": "",
  "ManualVerification": false,
  "Severity": "critical",
  "Tags": {
    "category": [
      "Compliance"
    ],
    "cis": [
      "true"
    ],
    "cis_item_id": [
      "4.5.1"
    ],
    "cis_level": [
      "2"
    ],
    "cis_section_id": [
      "4.5"
    ],
    "cis_type": [
      "manual"
    ],
    "cis_version": [
      "v1.5.0"
    ],
    "plugin": [
      "azure"
    ],
    "service": [
      "Azure/SQL"
    ],
    "x-kaytu-explanation": [
      "## Azure Control: Firewalls & Networks Configuration\n\nEnsure that 'Firewalls & Networks' is limited to use selected networks instead of all networks.\n\n### Instructions:\n\n1. Navigate to the Azure Portal.\n2. Go to the settings or configuration section for the relevant resource (e.g., Azure SQL Database, Azure Storage Account).\n3. Locate the 'Firewalls & Networks' or similar security configuration.\n4. Update the settings to restrict access to only selected networks.\n5. Save and apply the changes.\n\n### Rationale:\n\nBy limiting access to selected networks, you enhance the security of your Azure resources, reducing the attack surface and mitigating potential risks associated with unauthorized access.\n"
    ],
    "x-kaytu-noncompliance-cost": [
      "| Cost of Non-Compliance |\n|------------------------|\n| **Financial Impact**   |\n| - Increased risk of unauthorized access          |\n| - Potential data breaches and loss of sensitive information |\n| - Regulatory fines and legal consequences         |\n\n| **Operational Impact**  |\n| - Disruption to business operations               |\n| - Increased workload for incident response and mitigation  |\n| - Damage to reputation and customer trust         |\n\n| **Security Impact**     |\n| - Weakened security posture                       |\n| - Exposure to cyber threats and attacks           |\n| - Compromised confidentiality, integrity, and availability of data |\n\n| **Compliance Impact**   |\n| - Failure to meet regulatory requirements         |\n| - Audit failures and potential loss of certifications |\n| - Increased scrutiny from regulatory bodies      |\n"
    ],
    "x-kaytu-usefulness-example": [
      "To ensure that \"Firewalls & Networks\" is limited to use selected networks instead of all networks in Azure, you can use Azure Policy to enforce this control. Azure Policy is a service in Azure that you can use to create, assign, and manage policies.\n\nHere's an example of how you might define an Azure Policy in markup format to enforce this control:\n\njson\nCopy code\n{\n  \"mode\": \"All\",\n  \"policyRule\": {\n    \"if\": {\n      \"field\": \"type\",\n      \"equals\": \"Microsoft.Network/networkSecurityGroups\"\n    },\n    \"then\": {\n      \"effect\": \"deny\",\n      \"details\": {\n        \"type\": \"Microsoft.Network/networkSecurityGroups\",\n        \"existenceCondition\": {\n          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].access\",\n          \"equals\": \"Allow\"\n        }\n      }\n    }\n  },\n  \"parameters\": {}\n}\nExplanation:\n\nmode: Specifies the scope of the policy. In this case, \"All\" means the policy is applied to all resource types.\n\npolicyRule: Defines the conditions and actions of the policy.\n\nif: Specifies the condition for the policy to be applied. In this example, it checks if the resource type is \"Microsoft.Network/networkSecurityGroups\".\n\nthen: Specifies the action to be taken if the condition is met. In this case, it denies the creation of network security groups that have security rules with \"Allow\" access.\n\nparameters: Allows you to define any parameters needed for the policy. In this example, no parameters are used.\n\nThis policy ensures that network security groups with rules allowing traffic are denied, effectively limiting the use of selected networks. You can then assign this policy to your Azure subscriptions or resource groups as needed. Adjustments may be necessary based on the specific details of your networking setup and requirements."
    ]
  },
  "Managed": true
}