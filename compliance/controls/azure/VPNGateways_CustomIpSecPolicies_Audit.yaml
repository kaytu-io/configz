ID: a_custom_i_psec/_ike_policy_must_be_applied_to_all_azure_virtual_network_gateway_connections
Title: A custom IPsec/IKE policy must be applied to all Azure virtual network gateway connections
Description: This policy ensures that all Azure virtual network gateway connections use a custom Internet Protocol Security(Ipsec)/Internet Key Exchange(IKE) policy. Supported algorithms and key strengths - https://aka.ms/AA62kb0
Query:
    ID: ""
    Engine: odysseus-v0.0.1
    QueryToExecute: |
        SELECT *
        FROM azure_network_connections
        WHERE kaytu_account_id = 'account_id'
        AND kaytu_metadata->>'type' = 'Microsoft.Network/connections'
        AND (
            kaytu_metadata->'ipsecPolicies' IS NULL
            OR NOT (
                kaytu_metadata->'ipsecPolicies' @> '[{"ipsecEncryption": "IPsecEncryptionValue"}]'
                AND kaytu_metadata->'ipsecPolicies' @> '[{"ipsecIntegrity": "IPsecIntegrityValue"}]'
                AND kaytu_metadata->'ipsecPolicies' @> '[{"ikeEncryption": "IKEEncryptionValue"}]'
                AND kaytu_metadata->'ipsecPolicies' @> '[{"ikeIntegrity": "IKEIntegrityValue"}]'
                AND kaytu_metadata->'ipsecPolicies' @> '[{"dhGroup": "DHGroupValue"}]'
                AND kaytu_metadata->'ipsecPolicies' @> '[{"pfsGroup": "PFSGroupValue"}]'
            )
        )
        LIMIT 5;;
    Connector: Azure
    PrimaryTable: null
    ListOfTables: []
    Parameters: []
ManualVerification: false
Severity: medium
Tags: {}
Managed: false
