Description: Implementing Transparent Data Encryption (TDE) with your own key provides
  increased transparency and control over the TDE Protector, increased security with
  an HSM-backed external service, and promotion of separation of duties. This recommendation
  applies to organizations with a related compliance requirement.
ID: sql_servers_should_use_customer_managed_keys_to_encrypt_data_at_rest
Query:
  Connector: Azure
  Engine: odysseus-v0.0.1
  QueryToExecute: 'SELECT *

    FROM azure_sql_server

    WHERE type = ''Microsoft.Sql/servers''

    AND (kaytu_description -> ''Server'' -> ''properties'' ->> ''keyId'' IS NULL OR
    kaytu_description -> ''Server'' -> ''properties'' ->> ''keyId'' = '''')

    AND (kaytu_description -> ''Server'' -> ''properties'' -> ''EncryptionProtectors''
    -> 0 -> ''properties'' ->> ''serverKeyType'' IS NULL OR kaytu_description -> ''Server''
    -> ''properties'' -> ''EncryptionProtectors'' -> 0 -> ''properties'' ->> ''serverKeyType''
    != ''AzureKeyVault'')

    LIMIT 5;;

    '
Severity: ''
Title: SQL servers should use customer-managed keys to encrypt data at rest
