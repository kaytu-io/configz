{
  "ID": "azure_network_sg_flowlog_retention_period_greater_than_90",
  "Title": "Ensure that Network Security Group Flow Log retention period is 'greater than 90 days'",
  "Description": "Network Security Group Flow Logs should be enabled and the retention period is set to greater than or equal to 90 days.",
  "Query": {
    "Connector": "Azure",
    "Engine": "odysseus-v0.0.1",
    "ListOfTables": [
      "azure_network_security_group",
      "azure_network_watcher_flow_log",
      "azure_subscription"
    ],
    "PrimaryTable": "azure_network_security_group",
    "QueryToExecute": "select\n  sg.id resource,\n  sg.kaytu_account_id as kaytu_account_id,\n  sg.kaytu_resource_id as kaytu_resource_id,\n  case\n    when fl.id is null or not fl.enabled or fl.retention_policy_days \u003c 90 then 'alarm'\n    else 'ok'\n  end as status,\n  case\n    when fl.id is null or not fl.enabled\n      then sg.name || ' flowlog not enabled.'\n    when fl.retention_policy_days \u003c 90\n      then sg.name || ' flowlog ' || fl.title || ' retention period is less than 90 days.'\n    else sg.name || ' flowlog ' || fl.title || ' retention period is ' || fl.retention_policy_days || ' days.'\n  end as reason\n  \n  , sg.resource_group as resource_group\n  , sub.display_name as subscription\nfrom\n  azure_network_security_group sg\n  left join azure_network_watcher_flow_log fl on sg.id = fl.target_resource_id\n  join azure_subscription sub on sub.subscription_id = sg.subscription_id;\n"
  },
  "DocumentURI": "",
  "ManualVerification": false,
  "Severity": "high",
  "Tags": {
    "category": [
      "Compliance"
    ],
    "cis": [
      "true"
    ],
    "cis_item_id": [
      "6.4"
    ],
    "cis_level": [
      "2"
    ],
    "cis_section_id": [
      "6"
    ],
    "cis_type": [
      "automated"
    ],
    "cis_version": [
      "v1.3.0"
    ],
    "plugin": [
      "azure"
    ],
    "service": [
      "Azure/Network"
    ],
    "x-kaytu-explanation": [
      "AWS Network Security Group Flow Logs is a feature that enables you to capture information about the IP traffic coming to and leaving network interfaces in your AWS Virtual Private Cloud (VPC). This information can help you to understand the nature of the traffic and any potential security issues.\n\nThis AWS control ensures that the Network Security Group Flow Logs are enabled, providing you with insights and visibility into network traffic. The control also checks that the retention period for these logs is set to at least 90 days.\n\nThe retention setting guarantees that log data is stored and accessible for 90 days, which is important for troubleshooting, analysis, and compliance purposes.\n\nHere is a basic example of markup code (note that this is not real AWS Markup, it's only used to illustrate the concept):\n\n```markup\n\u003cAWSControl\u003e\n  \u003cName\u003eNetwork Security Group Flow Logs\u003c/Name\u003e\n  \u003cEnabled\u003eTrue\u003c/Enabled\u003e\n  \u003cRetentionPeriod\u003e90\u003c/RetentionPeriod\u003e \n\u003c/AWSControl\u003e\n```\n\nThis markup code represents the AWS control discussed. It indicates that the Network Security Group Flow Logs is enabled and sets the retention period to be at least 90 days. In an actual environment, the markup language and structure would be formatted based on the specific requirements of the AWS platform and tools utilized for managing and executing controls."
    ],
    "x-kaytu-noncompliance-cost": [
      "The cost of non-compliance to this AWS Control is majorly incurred in terms of security risk, potential monetary losses and regulatory breaches. Here's how it can impact:\n\n1. **Data Security Risk:** If Network Security Group Flow Logs are not enabled, there would be no data available for analyzing traffic patterns and identifying potential security threats, vulnerabilities or DDos attacks.\n\n2. **Regulatory Compliance:** Certain regulations, like GDPR, HIPAA or regional data protection laws, mandate logging of data access and transfer. Non-compliance can lead to penalties, fines and legal repercussions. \n\n3. **Forensic Analysis:** In case of any security breach or cyber attack, flow logs are crucial in forensic analysis and identifying the origin of the attack.\n\n4. **Business Continuity:** Without enabling flow logs, it becomes challenging to plan business continuity or disaster recovery as insights into network traffic are absent.\n\n5. **Monetary Loss:** In case of a security breach arising due to non-compliance, potential costs include breach remediation, identity protection services for affected customers, regulatory fines, potential lawsuits, and negative impact on the company’s reputation.\n\nHere is markup format description:\n\n```\n- **Data Security Risk:** Lack of flow logs means no data for analyzing traffic patterns or identifying potential security threats.\n- **Regulatory Compliance:** Non-compliance can result in penalties, fines, and legal issues due to regulations like GDPR, HIPAA.\n- **Forensic Analysis:** Flow logs play a crucial role in identifying the origin of an attack during forensic analysis.\n- **Business Continuity:** Absence of flow logs can cause challenges in planning for business continuity and disaster recovery.\n- **Monetary Loss:** Costs include punishments from regulators, lawsuits, and a negative impact on the company’s reputation resulting from a security breach due to non-compliance.  \n```\nKeep in mind that these costs may vary based on the nature of your AWS workloads and environment, the sensitivity of the data being handled, and the applicable regulatory frameworks."
    ],
    "x-kaytu-usefulness-example": [
      "AWS Network Security Group Flow Logs are extremely useful for troubleshooting network issues and conducting forensic investigations into suspicious network activity. \n\nFor example, suppose your organization has a policy to retain all network-related logs for at least 90 days. You suspect that there was unauthorized access to some of your instances about 60 days ago. \n\nYou can go to your Network Security Group Flow Logs (which have been enabled and set to keep logs for at least 90 days) to investigate this issue. You can check the incoming and outgoing IP addresses at the relevant times to see any unusual patterns or suspicious IP addresses.\n\nThis log can also help identify any traffic patterns, analyze network traffic flow, and determine whether any unacceptable rules are in place. \n\nHence, having the Network Security Group Flow Logs enabled and set to a retention period of 90 days or more can be extremely useful from a security investigation and network performance standpoint."
    ]
  },
  "Managed": true
}