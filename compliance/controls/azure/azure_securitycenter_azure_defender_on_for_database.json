{
  "ID": "azure_securitycenter_azure_defender_on_for_database",
  "Title": "Ensure That Microsoft Defender for Databases Is Set To 'On'",
  "Description": "Turning on Microsoft Defender for Databases enables threat detection for the instances running your database software. This provides threat intelligence, anomaly detection, and behavior analytics in the Azure Microsoft Defender for Cloud. Instead of being enabled on services like Platform as a Service (PaaS), this implementation will run within your instances as Infrastructure as a Service (IaaS) on the Operating Systems hosting your databases.",
  "Query": {
    "Connector": "Azure",
    "Engine": "odysseus-v0.0.1",
    "ListOfTables": [
      "azure_security_center_subscription_pricing",
      "azure_subscription"
    ],
    "PrimaryTable": "azure_security_center_subscription_pricing",
    "QueryToExecute": "with defender_list as (\n  select\n    json_object_agg(name, pricing_tier) as data,\n    subscription_id\n  from\n    azure_security_center_subscription_pricing\n  where\n    name = any(ARRAY ['CosmosDbs', 'OpenSourceRelationalDatabases', 'SqlServerVirtualMachines', 'SqlServers'])\n  group by\n    subscription_id\n)\nselect\n  sub.id as resource,\n  sub.kaytu_account_id as kaytu_account_id,\n  sub.kaytu_resource_id as kaytu_resource_id,\n  case\n    when\n      data -\u003e\u003e 'CosmosDbs' = 'Standard'\n      and data -\u003e\u003e 'OpenSourceRelationalDatabases' = 'Standard'\n      and data -\u003e\u003e 'SqlServerVirtualMachines' = 'Standard'\n      and data -\u003e\u003e 'SqlServers' = 'Standard'\n      then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when\n      data -\u003e\u003e 'CosmosDbs' = 'Standard'\n      and data -\u003e\u003e 'OpenSourceRelationalDatabases' = 'Standard'\n      and data -\u003e\u003e 'SqlServerVirtualMachines' = 'Standard'\n      and data -\u003e\u003e 'SqlServers' = 'Standard'\n      then 'Azure Defender on for Databases.'\n    else 'Azure Defender off for Databases.'\n  end as reason\n  \n  , sub.display_name as subscription\nfrom\n  azure_subscription as sub\n  left join defender_list as l on l.subscription_id = sub.subscription_id;\n"
  },
  "DocumentURI": "",
  "ManualVerification": false,
  "Severity": "high",
  "Tags": {
    "category": [
      "Compliance"
    ],
    "cis": [
      "true"
    ],
    "cis_item_id": [
      "2.1.3"
    ],
    "cis_level": [
      "2"
    ],
    "cis_section_id": [
      "2.1"
    ],
    "cis_type": [
      "manual"
    ],
    "cis_version": [
      "v1.5.0"
    ],
    "plugin": [
      "azure"
    ],
    "service": [
      "Azure/SecurityCenter"
    ],
    "x-kaytu-explanation": [
      "Azure Control: Microsoft Defender for Databases\n\nDescription:\nTurning on Microsoft Defender for Databases enables threat detection for the instances running your database software. This provides threat intelligence, anomaly detection, and behavior analytics in the Azure Microsoft Defender for Cloud. Instead of being enabled on services like Platform as a Service (PaaS), this implementation will run within your instances as Infrastructure as a Service (IaaS) on the Operating Systems hosting your databases.\n"
    ],
    "x-kaytu-noncompliance-cost": [
      "The cost of non-compliance for Microsoft Defender for Databases can vary based on factors such as the severity of security threats, potential data breaches, and regulatory penalties. Non-compliance may lead to compromised data integrity and confidentiality, financial losses, and damage to the organization's reputation. Exact monetary values depend on the specific consequences and legal implications in each case.\n\n"
    ],
    "x-kaytu-usefulness-example": [
      "An example instance of the usefulness of Microsoft Defender for Databases is the proactive detection and mitigation of a potential SQL injection attack on a critical database instance. By enabling threat detection, the system can identify anomalous activities, analyze behavior patterns, and provide timely alerts to administrators. In this scenario, the Azure control helps prevent data breaches and ensures the security of sensitive information stored in the databases.\n"
    ]
  },
  "Managed": true
}