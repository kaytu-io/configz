Description: The storage account container containing the activity log export should not be publicly accessible.
DocumentURI: ""
ID: azure_monitor_logs_storage_container_not_public_accessible
Managed: true
ManualVerification: false
Query:
  Connector: Azure
  Engine: odysseus-v0.0.1
  ListOfTables:
  - azure_storage_container
  - azure_subscription
  PrimaryTable: azure_storage_container
  QueryToExecute: |
    select
      sc.id as resource,
      sc.kaytu_account_id as kaytu_account_id,
      sc.kaytu_resource_id as kaytu_resource_id,
      case
        when public_access != 'None' then 'alarm'
        else 'ok'
      end as status,
      case
        when public_access != 'None'
          then account_name || ' container insights-operational-logs storing activity logs publicly accessible.'
        else account_name || ' container insights-operational-logs storing activity logs not publicly accessible.'
      end as reason
      , sc.resource_group as resource_group
      , sub.display_name as subscription
    from
      azure_storage_container sc,
      azure_subscription sub
    where
      name = 'insights-operational-logs'
      and sub.subscription_id = sc.subscription_id;
Severity: high
Tags:
  category:
  - Compliance
  cis:
  - "true"
  cis_item_id:
  - 5.1.3
  cis_level:
  - "1"
  cis_section_id:
  - "5.1"
  cis_type:
  - automated
  cis_version:
  - v1.3.0
  plugin:
  - azure
  service:
  - Azure/Monitor
  x-kaytu-explanation:
  - "### Control: Public Accessibility of Activity Log Storage Container\n\n**Description:**\nThe storage account container responsible for holding the activity log export in Azure should not be publicly accessible. This control is in place to ensure the confidentiality and integrity of the exported activity logs.\n\n**Potential Consequences of Non-Compliance:**\n- **Data Exposure:** Public accessibility increases the risk of unauthorized access to sensitive activity logs, leading to potential exposure of confidential information.\n- **Security Breach:** Publicly accessible containers may be vulnerable to unauthorized modifications or deletions, compromising the integrity of the stored logs.\n- **Compliance Violation:** Non-compliance with this control may result in violations of data protection and privacy regulations, leading to legal consequences and financial penalties.\n\n**Mitigation Strategies:**\n- Implement proper storage account configurations to restrict public access to the container.\n- Use role-based access control (RBAC) to grant necessary permissions only to authorized personnel.\n- Regularly monitor and audit access controls to ensure ongoing compliance.\n\n**Cost of Non-Compliance:**\nThe cost of non-compliance includes potential fines, legal actions, damage to reputation, and the expenses associated with investigating and mitigating security incidents. Additionally, there may be operational disruptions and a loss of trust from customers and stakeholders.\n\n**Note:**\nEnsuring the security of the storage account container is crucial for maintaining the confidentiality and integrity of activity logs, and organizations should prioritize the implementation of appropriate measures to meet this control.\n"
  x-kaytu-noncompliance-cost:
  - "### Azure Control: Storage Account Container Access\n\n**Description:** The storage account container containing the activity log export should not be publicly accessible.\n\n**Cost of Non-Compliance:**\n- **Financial Penalties:** Non-compliance may lead to regulatory fines and penalties.\n- **Data Security Risks:** Public accessibility increases the risk of unauthorized access and data breaches.\n- **Reputation Damage:** Breaches in compliance can harm the organization's reputation and trust.\n- **Legal Consequences:** Violations may result in legal actions and liabilities.\n\n**Mitigation Steps:**\n1. Configure storage account settings to restrict public access.\n2. Implement role-based access control (RBAC) to ensure proper permissions.\n3. Regularly audit and monitor access to the storage account container.\n\n**Compliance Status Monitoring:**\nRegularly review and audit the storage account settings to ensure continued compliance. Implement automated monitoring tools for real-time alerts on any unauthorized access attempts.\n\n"
  x-kaytu-usefulness-example:
  - "{\n  \"if\": {\n    \"allOf\": [\n      {\n        \"field\": \"type\",\n        \"equals\": \"Microsoft.Storage/storageAccounts\"\n      },\n      {\n        \"field\": \"Microsoft.Storage/storageAccounts/blobServices/containers/publicAccess\",\n        \"equals\": \"Container\"\n      },\n      {\n        \"field\": \"Microsoft.Storage/storageAccounts/blobServices/containers/name\",\n        \"equals\": \"<your-container-name>\"\n      }\n    ]\n  },\n  \"then\": {\n    \"effect\": \"deny\"\n  }\n}\n"
Title: Ensure the storage container storing the activity logs is not publicly accessible
