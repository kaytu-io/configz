{
  "ID": "azure_securitycenter_automatic_provisioning_monitoring_agent_on",
  "Title": "Ensure that 'Automatic provisioning of monitoring agent' is set to 'On'",
  "Description": "Enable automatic provisioning of the monitoring agent to collect security data.",
  "Query": {
    "Connector": "Azure",
    "Engine": "odysseus-v0.0.1",
    "ListOfTables": [
      "azure_security_center_auto_provisioning",
      "azure_subscription"
    ],
    "PrimaryTable": "azure_security_center_auto_provisioning",
    "QueryToExecute": "select\n  sc_prov.id as resource,\n  sc_prov.kaytu_account_id as kaytu_account_id,\n  sc_prov.kaytu_resource_id as kaytu_resource_id,\n  case\n    when auto_provision = 'On' then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when auto_provision = 'On' then 'Automatic provisioning of monitoring agent is on.'\n    else 'Automatic provisioning of monitoring agent is off.'\n  end as reason\n  \n  , sub.display_name as subscription\nfrom\n  azure_security_center_auto_provisioning sc_prov\n  right join azure_subscription sub on sc_prov.subscription_id = sub.subscription_id;\n"
  },
  "DocumentURI": "",
  "ManualVerification": false,
  "Severity": "high",
  "Tags": {
    "category": [
      "Compliance"
    ],
    "cis": [
      "true"
    ],
    "cis_item_id": [
      "2.11"
    ],
    "cis_level": [
      "1"
    ],
    "cis_section_id": [
      "2"
    ],
    "cis_type": [
      "automated"
    ],
    "cis_version": [
      "v1.3.0"
    ],
    "plugin": [
      "azure"
    ],
    "service": [
      "Azure/SecurityCenter"
    ],
    "x-kaytu-explanation": [
      "This control involves enabling Amazon Web Services (AWS) to automatically provision monitoring agents to collect security data. This data could be related to different AWS resources and services used within your infrastructure. The control helps in identifying security vulnerabilities, abnormalities, or threats. The AWS monitoring agent will also track and analyze the activities for suspicious behavior and generate alerts in real-time.\n\nHere is an example of how to use the AWS CloudFormation tool to enable automatic provisioning of the monitoring agent in a markup format.\n\n```markup\nResources:\n  MonitoringAgent:\n    Type: 'AWS::CloudWatch::Agent'\n    Properties:\n      InstanceId: InstanceId\n      Credentials:\n        AccessKeyId: AccessKeyId\n        SecretAccessKey: SecretAccessKey\n      Region: us-west-2\n      AutoScalingGroupName: AutoScalingGroupName\n```\nThis solution involves the use of AWS CloudWatch Agent. This example is given in YAML format which is used by AWS CloudFormation to enable this control. \n\nItâ€™s important to replace 'InstanceId', 'AccessKeyId', 'SecretAccessKey', and 'AutoScalingGroupName' with your actual AWS identifiers. \n\nRemember to always keep your 'AccessKeyId' and 'SecretAccessKey' confidential to prevent any unauthorized access to your AWS resources. \n\nThis is a very basic example. You can customize this according to your requirements by adding more configurations and settings."
    ],
    "x-kaytu-noncompliance-cost": [
      "AWS recommends enabling automatic provisioning of the monitoring agent for the effective collection of security data. Non-compliance to this control can lead to the following potential costs:\n\n1. **Security Risks**: Not having an automatic provisioning of the monitoring agent might lead to potential security risks. The agent collects valuable security data that can thwart potential cyber threats. Lack of security monitoring can leave your system vulnerable.\n\n2. **Increased Operational Costs**: Manual monitoring processes might increase your operational costs. Automatic provisioning helps maintain a systematic monitoring workflow and is generally more cost-effective.\n\n3. **Potential Data Loss**: In case of a cyber attack or system malfunction, without automatic security data collection, you might suffer significant data loss, which might be both costly and detrimental to the operation of your system.\n\n4. **Regulatory Fines**: If your business is part of an industry that's subject to regulatory standards, non-compliance with those standards, such as not automatically collecting and monitoring security data, could result in costly fines or sanctions.\n\n5. **Damage to Reputation**: If a data breach were to occur, it could severely damage your company's reputation, resulting in loss of client trust and potential business.\n\n6. **Lack of Insights**: Automatic monitoring provides valuable insights into the functioning of your system. You could miss these insights without provisioned monitoring, leading to unoptimized system performance."
    ],
    "x-kaytu-usefulness-example": [
      "Scenario: An e-commerce company's security team has been experiencing difficulties in efficiently tracking and collecting security data across all their AWS instances. They need a solution that would allow them to collect and analyze security data round-the-clock without any significant resource involvement manually.\n\nIn this case, the implementation of an automatic provisioning of the AWS monitoring agent becomes very useful. By enabling the automatic provisioning, the team can ensure that their instances will automatically deploy the monitoring agents. These agents then actively collect and send security logs and data to a centralized location, such as Amazon CloudWatch or AWS Security Hub, for analysis and alerting.\n\nThis will help the team to get near real-time insights into any potential security threats or breaches, improve their incident response time, and minimize potential damages. It further helps in maintaining mandatory compliance as needed for the business.\n\n```\n{\n \"Resources\": {\n    \"MonitoringAgent\": {\n      \"Type\": \"AWS::CloudFormation::Init\",\n      \"Properties\": {\n        \"AWS::CloudFormation::Authentication\": {\n          \"role\": {\n            \"type\": \"AWS::IAM::Role\",\n            \"roleName\": \"MonitoringAgentProvisioningRole\"\n          }\n        },\n        \"AWS::CloudFormation::Init\": {\n          \"config\": {\n            \"files\": {\n              \"/etc/awslogs/awslogs.conf\": {\n                \"source\": \"https://aws-cloudformation-templates.s3.amazonaws.com/awslogs.conf\",\n                \"mode\": \"000400\",\n                \"owner\": \"root\",\n                \"group\": \"root\"\n              }\n            },\n            \"services\": {\n              \"sysvinit\": {\n                \"awslogs\": {\n                  \"enabled\": \"true\",\n                  \"ensureRunning\": \"true\",\n                  \"packages\": {\n                    \"yum\": {\n                      \"awslogs\": []\n                    }\n                  },\n                  \"files\": [\n                    \"/etc/awslogs/awslogs.conf\"\n                  ]\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\nIn the above AWS CloudFormation snippet, a monitoring agent is being provisioned automatically using the `AWS::CloudFormation::Init` resource. The necessary files and services are defined for the agent to collect the logs and ensure they're running on the instances. The data and logs collected by this agent will then be available for the security team to analyze and maintain a secure environment."
    ]
  },
  "Managed": true
}