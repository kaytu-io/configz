Description: Disable RDP access on network security groups from the Internet.
DocumentURI: ""
ID: azure_network_security_group_rdp_access_restricted
Managed: true
ManualVerification: false
Query:
  Connector: Azure
  Engine: odysseus-v0.0.1
  ListOfTables:
  - azure_network_security_group
  - azure_subscription
  PrimaryTable: azure_network_security_group
  QueryToExecute: "with network_sg as (\n  select\n    distinct name sg_name\n  from\n    azure_network_security_group nsg,\n    jsonb_array_elements(security_rules) sg,\n    jsonb_array_elements_text(sg -> 'properties' -> 'destinationPortRanges' || (sg -> 'properties' -> 'destinationPortRange') :: jsonb) dport,\n    jsonb_array_elements_text(sg -> 'properties' -> 'sourceAddressPrefixes' || (sg -> 'properties' -> 'sourceAddressPrefix') :: jsonb) sip\n  where\n    sg -> 'properties' ->> 'access' = 'Allow'\n    and sg -> 'properties' ->> 'direction' = 'Inbound'\n    and (sg -> 'properties' ->> 'protocol' ilike 'TCP' or sg -> 'properties' ->> 'protocol' = '*')\n    and sip in ('*', '0.0.0.0', '0.0.0.0/0', 'Internet', 'any', '<nw>/0', '/0')\n    and (\n      dport in ('3389', '*')\n      or (\n        dport like '%-%'\n        and split_part(dport, '-', 1) :: integer <= 3389\n        and split_part(dport, '-', 2) :: integer >= 3389\n      )\n    )\n)\nselect\n  sg.id resource,\n  sg.kaytu_account_id as kaytu_account_id,\n  sg.kaytu_resource_id as kaytu_resource_id,\n  case\n    when nsg.sg_name is null then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when nsg.sg_name is null\n      then sg.title || ' restricts RDP access from internet.'\n    else sg.title || ' allows RDP access from internet.'\n  end as reason\n  \n  , sg.resource_group as resource_group\n  , sub.display_name as subscription\nfrom\n  azure_network_security_group sg\n  left join network_sg nsg on nsg.sg_name = sg.name\n  join azure_subscription sub on sub.subscription_id = sg.subscription_id;\n"
Severity: high
Tags:
  category:
  - Compliance
  cis:
  - "true"
  cis_item_id:
  - "6.1"
  cis_level:
  - "1"
  cis_section_id:
  - "6"
  cis_type:
  - automated
  cis_version:
  - v1.3.0
  plugin:
  - azure
  service:
  - Azure/Network
  x-kaytu-explanation:
  - "Azure Control: Disable RDP access on network security groups from the Internet\nDescription: This control ensures that Remote Desktop Protocol (RDP) access is disabled on network security groups (NSGs) for communication from the Internet.\nImplementation:\n  - Create or modify NSGs associated with relevant resources.\n  - Set inbound rules to deny RDP traffic from Internet IP ranges.\n  - Regularly review and audit NSG configurations to maintain compliance.\nImpact:\n  - Enhances security by preventing unauthorized RDP access.\n  - Mitigates potential risks associated with Internet-exposed RDP services.\n"
  x-kaytu-noncompliance-cost:
  - "Non-compliance with the Azure Control to Disable RDP access on network security groups from the Internet can lead to significant costs, including:\n\nSecurity Risks:\n\nExposure to unauthorized access: Leaving RDP open to the Internet increases the risk of unauthorized users gaining access to sensitive resources.\nData Breach Costs:\n\nPotential data breaches: Non-compliance may result in security incidents leading to data breaches, with associated financial and reputational damages.\nRegulatory Penalties:\n\nViolation of compliance standards: Failure to adhere to security controls may lead to regulatory non-compliance, triggering fines and penalties.\nOperational Impact:\n\nDisruption of services: Security incidents or breaches can disrupt operations, leading to downtime and additional recovery costs.\nIt is crucial to comply with this control to mitigate these potential costs and safeguard the security and integrity of Azure resources."
  x-kaytu-usefulness-example:
  - "Consider a scenario in which an organization hosts critical business applications on Azure virtual machines. By implementing the Azure Control to Disable RDP access on network security groups from the Internet, the organization can achieve the following:\n\nUse Case: Protection Against Unauthorized Access\n\nScenario:\n\nThe organization's Azure VMs host a database containing sensitive customer information.\nWithout proper security controls, RDP access is open to the Internet, posing a potential security risk.\nUsefulness of the Control:\n\nEnhanced Security:\n\nBy configuring NSGs to deny RDP traffic from the Internet, the organization prevents unauthorized access attempts.\nMitigates the risk of malicious actors exploiting RDP vulnerabilities to compromise the database.\nCompliance Assurance:\n\nAdhering to security best practices ensures compliance with industry and regulatory standards.\nDemonstrates a proactive approach to safeguarding customer data, meeting data protection requirements.\nOperational Continuity:\n\nMinimizes the likelihood of security incidents that could disrupt business operations.\nEnsures continuous availability of critical applications without compromising security.\nIn this instance, the Azure Control proves useful in fortifying the organization's security posture, safeguarding sensitive data, and maintaining operational resilience."
Title: Ensure that RDP access is restricted from the internet
