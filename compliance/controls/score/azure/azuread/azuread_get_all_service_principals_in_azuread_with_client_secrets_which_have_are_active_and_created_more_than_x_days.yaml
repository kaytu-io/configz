ID: azuread_get_all_service_principals_in_azuread_with_client_secrets_which_have_are_active_and_created_more_than_x_days
Title: Get all Service Principals in AzureAD with Client Secrets which have are active and Created more than X days
Description: Ensure that Azure Key Vault certificates are using the appropriate key type(s).
Query:
  ID: ""
  Engine: odysseus-v0.0.1
  QueryToExecute: |
    select
      display_name as app_name,
      app_id,
      pc ->> 'DisplayName' as password_credential_name,
      pc ->> 'StartDateTime' as start_date_time,
      pc ->> 'EndDateTime' as end_date_time,
      now() - (pc ->> 'StartDateTime')::timestamp
    from
      azuread_application,
      jsonb_array_elements(password_credentials) as pc
    where
      now() - (pc ->> 'StartDateTime')::timestamp > '{{.azureadClientSecretExpireDays}} days'::interval
  Connector: Azure
  PrimaryTable: azuread_application
  ListOfTables:
    - azuread_application
ManualVerification: false
Severity: medium
Tags:
  score_service_name:
    - Azure KeyVault
Managed: false
